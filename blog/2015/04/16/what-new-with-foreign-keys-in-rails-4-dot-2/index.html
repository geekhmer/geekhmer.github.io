
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>What New with Foreign Keys in Rails 4.2? - GeeKhmer</title>
  <meta name="author" content="Bunlong Van">
  
  
  <meta name="description" content="The biggest website of computer programming, Ruby, Ruby on Rails, Erlang, Chicagoboss and Javascript in Southeast Asia.">

  <meta name="keywords" content="What New with Foreign Keys in Rails 4.2?, What New with Foreign Keys in Ruby on Rails 4.2?, Foreign Keys in Rails 4.2, Foreign Keys in Ruby on Rails 4.2?">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://geekhmer.github.io/blog/2015/04/16/what-new-with-foreign-keys-in-rails-4-dot-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="GeeKhmer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<link href="/stylesheets/jquery.fancybox.css" media="screen, projection" rel="stylesheet" type="text/css">
<script src="/javascripts/libs/jquery.fancybox.pack.js"></script>
<script src="/javascripts/init_fancybox.js"></script>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1>
    <!-- <a href="/">GeeKhmer</a> -->
    <div class="logo" />
  </h1>
  
</hgroup>

</header>
  <nav role="navigation">
  <form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:geekhmer.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
  </form>

<ul class="subscription" data-subscription="rss">
  
  
</ul>
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Articles</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">What New With Foreign Keys in Rails 4.2?</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-04-16T15:43:00+07:00" pubdate data-updated="true">Apr 16<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>
  <img src="/images/ruby_on_rails.png" width="400" alt="What New with Foreign Keys in Rails 4.2?" />
</p>




<p>
  Previous versions of Rails did not have the ability to create foreign keys without resorting to executing SQL statements directly. This lead to messy, database dependent solutions that weren&#8217;t very nice. 
</p>




<p>
  Luckily, Rails 4.2 rectifies this with new features to add and remove foreign keys. In this article we will discuss what foreign keys are, and how to add them to your database.
</p>




<p>
  If you don&#8217;t know what a foreign key is, well, quite simply, a foreign key links one table to another&#8217;s primary key. For example, if I have an authors table and a books table, I could create a foreign key that points from books back to authors, linking the two tables together. Then, these two tables become linked. It means that I cannot add or update the record with invalid data for the author_id field in the books table.  I can also tell the database server what to do when I update or delete the record. For example, I can tell rails to automatically delete child records when the parent is deleted (delete an author from the authors table and all the author&#8217;s books are deleted). I could also tell Rails to set the author_id column to null or to simply not let me delete the author while child records exist.
</p>




<p>
  <strong>Add Foreign Keys</strong><br/>
  To add a foreign key to the books table:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">add_foreign_key</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:authors</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  We can also give the foreign key a custom name:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">add_foreign_key</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:authors</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="ss">:my_foreign_key</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  If we are using a non Rails friendly database, we can specify the column names we wish to use for the foreign key. For example, let&#8217;s say the primary key of the authors table is author_id and the key in the books table is auid. We could simply use the following code to create the foreign key:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">add_foreign_key</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:authors</span><span class="p">,</span> <span class="ss">column</span><span class="p">:</span> <span class="ss">:auid</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">:</span> <span class="ss">:author_id</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  We can control the behavior of the foreign key as well. A list of the available behaviors are below. Independent behaviors can be set for both update as well as delete.<br/>
  - :restrict (default) - Prevents changes from being made.<br/>
  - :nullify - Sets the child columns to null.<br/>
  - :cascade - Cascades down to the child records. For instance, deleting an author deletes the author&#8217;s books.
</p>




<p>
  To specify behaviors, you simply use the <code>on_delete</code> or <code>on_update</code> parameters. For example, the following code would cascade deletes so that the books get deleted when the parent gets deleted.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">add_foreign_key</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:authors</span><span class="p">,</span> <span class="n">on_delete</span><span class="p">:</span> <span class="n">cascade</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Delete Foreign Keys</strong><br/>
  It is just as easy to delete foreign keys:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">remove_foreign_key</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">:authors</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  You can optionally specify the name of the foreign key to delete:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">remove_foreign_key</span> <span class="ss">:books</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="ss">:my_foreign_key</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  If you have non Rails friendly column names, you can specify the column name that contains the foreign key you wish to remove:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">remove_foreign_key</span> <span class="ss">:books</span><span class="p">,</span> <span class="ss">column</span><span class="p">:</span> <span class="ss">:auid</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  So far so good, That&#8217;s it!!! See ya!!! :)
</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bunlong Van</span></span>

      








  


<time datetime="2015-04-16T15:43:00+07:00" pubdate data-updated="true">Apr 16<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ruby/'>Ruby</a>, <a class='category' href='/blog/categories/ruby-on-rails/'>Ruby on Rails</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://geekhmer.github.io/blog/2015/04/16/what-new-with-foreign-keys-in-rails-4-dot-2/" data-via="" data-counturl="http://geekhmer.github.io/blog/2015/04/16/what-new-with-foreign-keys-in-rails-4-dot-2/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/04/16/ruby-on-rails-filter-vs-action/" title="Previous Post: Ruby on Rails _filter vs _action">&laquo; Ruby on Rails _filter vs _action</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/04/16/how-to-build-a-sitemap-for-your-ruby-on-rails-application/" title="Next Post: How to Build a Sitemap for Your Ruby on Rails Application">How to Build a Sitemap for Your Ruby on Rails Application &raquo;</a>
      
    </p>
  </footer>
</article>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/20/how-technology-company-make-money/">How Technology Company Make Money?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/19/5-tips-to-scale-your-ruby-on-rails-application/">5 Tips to Scale Your Ruby on Rails Application</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/16/ip-geolocation-in-ruby-on-rails-application/">IP Geolocation in Ruby on Rails Application</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/14/code-concerns-in-rails-4-models/">Code Concerns in Rails 4 Models</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/13/awesome-jquery-tricks/">Awesome jQuery Tricks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/11/ruby-on-rails-with-bootstrap-sass/">Ruby on Rails With Bootstrap-Sass</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/11/enable-compression-for-nginx/">Enable Compression for Nginx</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Category</h1>
  <ul id="recent_posts">
    
      <li>
        <a href="/blog/categories/facebook/">Facebook [ 4 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby/">Ruby [ 93 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/heroku/">Heroku [ 2 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby-on-rails/">Ruby on rails [ 84 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/testing/">Testing [ 5 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/layout/">Layout [ 3 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby-metaprogramming/">Ruby metaprogramming [ 4 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/websocket/">Websocket [ 2 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/front-end-mvc-framework/">Front-end mvc framework [ 1 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/javascript/">Javascript [ 4 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/erlang/">Erlang [ 20 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/design-pattern/">Design pattern [ 1 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/other/">Other [ 20 ]</a>
      </li>
    
  </ul>
</section><section>
  <h1>Notes</h1>
  <ul id="recent_posts">
    <li>
      <a href="http://vimcommands.github.io/" target="_blank">Vim Commands</a>
    </li>
    <li>
      <a href="http://ruby-hacking-style-guide.github.io/" target="_blank">Ruby Hacking Style Guide</a>
    </li>
  </ul>
</section><section>
  <h1>References</h1>
  <ul id="recent_posts">
    <li>
      <a href="http://www.erlang.org/" target="_blank">
        <img src="/images/logo_erlang.png" />
      </a>
    </li>
    <li>
      <a href="http://www.chicagoboss.org/" target="_blank">
        <img src="/images/logo_chicagoboss.svg" />
      </a>
    </li>
    <li>
      <a href="https://www.ruby-lang.org/en/" target="_blank">
        <img src="/images/logo_ruby.png" />
      </a>
    </li>
    <li>
      <a href="http://guides.rubyonrails.org" target="_blank">
        <img src="/images/logo_rails_guides.png" />
      </a>
    </li>
    <li>
      <a href="http://railscasts.com" target="_blank">
        <img src="/images/logo_rails_casts.png" />
      </a>
    </li>
    <li>
      <a href="https://github.com" target="_blank">
        <img src="/images/logo_github.png" />
      </a>
    </li>
    <li>
      <a href="https://www.linode.com" target="_blank">
        <img src="/images/logo_linode.png" />
      </a>
    </li>
    <li>
      <a href="http://newrelic.com" target="_blank">
        <img src="/images/logo_newrelic.png" />
      </a>
    </li>
    <li>
      <a href="https://developers.facebook.com/" target="_blank">
        <img src="/images/logo_facebook.png" />
      </a>
    </li>
  </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 GeeKhmer in Phnom Penh, Cambodia.
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=1451301955117043&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

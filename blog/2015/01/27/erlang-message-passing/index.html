
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Erlang Message Passing - GeeKhmer</title>
  <meta name="author" content="Bunlong Van">
  
  
  <meta name="description" content="The biggest website of computer programming, Ruby, Ruby on Rails, Erlang, Chicagoboss and Javascript in Southeast Asia.">

  <meta name="keywords" content="The Erlang Learning Sequence, Learning Erlang, Learn Erlang, Study Erlang, Studying Erlang, The Studying Erlang, Chicagoboss Framwork, Erlang Modules and Compiling, Modules and Compiling, Erlang Recursion, Recursion, Erlang Tail Recursion, Tail Recursion, Erlang Control Flow Statement, Erlang Control Flow, Flow Statement, Erlang List ane List Module, Erlang List, Erlang List Module, Erlang List Comprehension, List Comprehension, Erlang Concurrency, Concurrency, Erlang Message Passing, Message Passing">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://geekhmer.github.io/blog/2015/01/27/erlang-message-passing">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="GeeKhmer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<link href="/stylesheets/jquery.fancybox.css" media="screen, projection" rel="stylesheet" type="text/css">
<script src="/javascripts/libs/jquery.fancybox.pack.js"></script>
<script src="/javascripts/init_fancybox.js"></script>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1>
    <!-- <a href="/">GeeKhmer</a> -->
    <div class="logo" />
  </h1>
  
</hgroup>

</header>
  <nav role="navigation">
  <form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:geekhmer.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
  </form>

<ul class="subscription" data-subscription="rss">
  
  
</ul>
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Articles</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Erlang Message Passing</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-27T23:07:00+07:00" pubdate data-updated="true">Jan 27<span>th</span>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>
  <img src="/images/logo_erlang.png" alt="Erlang Message Passing" />
</p>




<p>
  The communication model (among processes) in Erlang is message passing. Erlang processes share no memory. The way that processes communicate is via (asynchronous) message passing. Every process (even the shell) holds a mailbox queue where incoming messages are placed until received by the process. Message passing is asynchronous because the sending process does not block on send. On the other hand, receiving a message in Erlang is a blocking operation.
</p>




<p>
  <h3>Characteristics</h3>
</p>




<p>
  In this subsection I will describe some of the characteristics of message passing in Erlang.
</p>




<p>
  <strong>Asynchronous</strong><br/>
  Message passing in Erlang is a non-blocking operation.
</p>




<p>
  <strong>Data Copy</strong><br/>
  The message’s data are copied from the sending process to the receiver’s message queue, so the receiver gets a fresh copy of the data.
</p>




<p>
  <strong>Ordering</strong><br/>
  Erlang runtime guarantees that if two messages are sent from node A to node B and both are delivered, then the ordering of these messages is kept (because ordering).
</p>




<p>
  <strong>Successful Send</strong><br/>
  The send operation always succeeds (even if the target is a non-existing process) and evaluates to the data sent. An exception is when trying to send data to a non-existing registered process.
</p>




<p>
  <h3>Sending Messages</h3>
</p>




<p>
  Erlang uses the exclamation mark (!) as the operator for sending a message.
</p>




<p>
  Syntax:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">%</span><span class="nb">send</span> <span class="n">message</span> <span class="no">Message</span> <span class="n">to</span> <span class="n">the</span> <span class="n">process</span> <span class="n">with</span> <span class="n">pid</span> <span class="no">Pid</span>
</span><span class='line'><span class="no">Pid</span> <span class="o">!</span> <span class="no">Message</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Send multiple messages &#8220;at once&#8221;:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Pid1</span> <span class="o">!</span> <span class="no">Message</span><span class="p">,</span> <span class="no">Pid2</span> <span class="o">!</span> <span class="no">Message</span><span class="p">,</span> <span class="no">Pid3</span> <span class="o">!</span> <span class="no">Message</span>
</span><span class='line'><span class="no">Pid1</span> <span class="o">!</span> <span class="p">(</span><span class="no">Pid2</span> <span class="o">!</span> <span class="p">(</span><span class="no">Pid3</span> <span class="o">!</span> <span class="no">Message</span><span class="p">))</span>
</span><span class='line'><span class="no">Pid1</span> <span class="o">!</span> <span class="no">Pid2</span> <span class="o">!</span> <span class="no">Pid3</span> <span class="o">!</span> <span class="no">Message</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Example:
</p>




<p>
  As I have mentioned before, the shell is nothing more than a process. As a process, it has a message queue. In order to print and empty the shell’s message queue we can use the flush/0 BIFs.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">1</span><span class="o">&gt;</span> <span class="nb">self</span><span class="p">()</span> <span class="o">!</span> <span class="n">erlang_term_can_be_sent</span><span class="o">.</span>
</span><span class='line'><span class="n">erlang_term_can_be_sent</span>
</span><span class='line'><span class="mi">2</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span><span class="o">.</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">erlang_term_can_be_sent</span>
</span><span class='line'><span class="n">ok</span>
</span><span class='line'><span class="mi">3</span><span class="o">&gt;</span> <span class="nb">self</span><span class="p">()</span> <span class="o">!</span> <span class="o">[</span><span class="n">this</span><span class="p">,</span> <span class="n">is</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">list</span><span class="p">,</span> <span class="s1">&#39;of&#39;</span><span class="p">,</span> <span class="n">atoms</span><span class="o">].</span>
</span><span class='line'><span class="o">[</span><span class="n">this</span><span class="p">,</span><span class="n">is</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">list</span><span class="p">,</span><span class="s1">&#39;of&#39;</span><span class="p">,</span><span class="n">atoms</span><span class="o">]</span>
</span><span class='line'><span class="mi">4</span><span class="o">&gt;</span> <span class="nb">self</span><span class="p">()</span> <span class="o">!</span> <span class="p">{</span><span class="n">this</span><span class="p">,</span> <span class="o">[</span><span class="n">is</span><span class="p">,</span> <span class="n">a</span><span class="o">]</span><span class="p">,</span> <span class="n">tuple</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">}}</span><span class="o">.</span>
</span><span class='line'><span class="p">{</span><span class="n">this</span><span class="p">,</span><span class="o">[</span><span class="n">is</span><span class="p">,</span><span class="n">a</span><span class="o">]</span><span class="p">,</span><span class="n">tuple</span><span class="p">,{</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="s1">&#39;!&#39;</span><span class="p">}}</span>
</span><span class='line'><span class="mi">5</span><span class="o">&gt;</span> <span class="nb">self</span><span class="p">()</span> <span class="o">!</span> <span class="p">{</span><span class="nb">self</span><span class="p">(),</span> <span class="mi">123</span><span class="p">}</span><span class="o">.</span>
</span><span class='line'><span class="p">{</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">35</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="mi">123</span><span class="p">}</span>
</span><span class='line'><span class="mi">6</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span><span class="o">.</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="o">[</span><span class="n">this</span><span class="p">,</span><span class="n">is</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">list</span><span class="p">,</span><span class="s1">&#39;of&#39;</span><span class="p">,</span><span class="n">atoms</span><span class="o">]</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="p">{</span><span class="n">this</span><span class="p">,</span><span class="o">[</span><span class="n">is</span><span class="p">,</span><span class="n">a</span><span class="o">]</span><span class="p">,</span><span class="n">tuple</span><span class="p">,{</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="s1">&#39;!&#39;</span><span class="p">}}</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="p">{</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">35</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">,</span><span class="mi">123</span><span class="p">}</span>
</span><span class='line'><span class="n">ok</span>
</span><span class='line'><span class="mi">7</span><span class="o">&gt;</span> <span class="no">Pid1</span> <span class="o">=</span> <span class="nb">self</span><span class="p">(),</span> <span class="no">Pid2</span> <span class="o">=</span> <span class="nb">self</span><span class="p">(),</span> <span class="no">Pid3</span> <span class="o">=</span> <span class="nb">self</span><span class="p">()</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">35</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span>
</span><span class='line'><span class="mi">8</span><span class="o">&gt;</span> <span class="no">Pid1</span> <span class="o">!</span> <span class="n">msg</span><span class="p">,</span> <span class="no">Pid2</span> <span class="o">!</span> <span class="n">msg</span><span class="p">,</span> <span class="no">Pid3</span> <span class="o">!</span> <span class="n">msg</span><span class="o">.</span>
</span><span class='line'><span class="n">msg</span>
</span><span class='line'><span class="mi">9</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span><span class="o">.</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="n">ok</span>
</span><span class='line'><span class="mi">10</span><span class="o">&gt;</span> <span class="no">Pid1</span> <span class="o">!</span> <span class="p">(</span><span class="no">Pid2</span> <span class="o">!</span> <span class="p">(</span><span class="no">Pid3</span> <span class="o">!</span> <span class="n">msg</span><span class="p">))</span><span class="o">.</span>
</span><span class='line'><span class="n">msg</span>
</span><span class='line'><span class="mi">11</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span><span class="o">.</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="n">ok</span>
</span><span class='line'><span class="mi">12</span><span class="o">&gt;</span> <span class="no">Pid1</span> <span class="o">!</span> <span class="no">Pid2</span> <span class="o">!</span> <span class="no">Pid3</span> <span class="o">!</span> <span class="n">msg</span><span class="o">.</span>
</span><span class='line'><span class="n">msg</span>
</span><span class='line'><span class="mi">13</span><span class="o">&gt;</span> <span class="n">flush</span><span class="p">()</span><span class="o">.</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="no">Shell</span> <span class="n">got</span> <span class="n">msg</span>
</span><span class='line'><span class="n">ok</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <h3>Receiving Messages</h3>
</p>




<p>
  Erlang uses pattern matching for receiving messages (same as in function clause selection and the case statement). The receive statement is used to deliver messages from the message queue.
</p>




<p>
  Syntax:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">receive</span>
</span><span class='line'>  <span class="no">Pattern1</span> <span class="k">when</span> <span class="no">Guard1</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="no">ToDo1</span><span class="p">;</span>
</span><span class='line'>  <span class="no">Pattern2</span> <span class="k">when</span> <span class="no">Guard2</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="no">ToDo2</span><span class="p">;</span>
</span><span class='line'>  <span class="n">_Other</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="no">Catch_all</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Receiving Order</strong><br/>
  The message processing is done in a FIFS (First In – First Served) order. Every incoming message is placed in the tail of the process’ message queue. When a receive statement is meet the following processing happens:<br/>
  1. The first message (head of the message queue) is pattern matched against the first receive clause. If match, execute the clause’s body, else go to the next step.<br/>
  2. The same message is pattern matched against the second (if any) receive clause. If match, execute the clause’s body, else go to the next step.<br/>
  3. &#8230;
  4. The same message is pattern matched against the last clause. If match, execute the clause’s body, else go to the next step.
  5. The same iterative process starts again from step 1, but now with the next message from the message queue.<br/><br/>
  The message (if any) that is delivered through receive is removed from the message queue.
</p>




<p>
  Example:
</p>




<figure class='code'><figcaption><span>pingpong.erl </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">-</span><span class="n">module</span><span class="p">(</span><span class="n">pingpong</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'><span class="o">-</span><span class="n">export</span><span class="p">(</span><span class="o">[</span><span class="n">play</span><span class="o">/</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">play</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="k">when</span> <span class="n">is_integer</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="no">Pong</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="n">fun</span> <span class="n">pong</span><span class="o">/</span><span class="mi">0</span><span class="p">),</span>
</span><span class='line'>  <span class="n">ping</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="no">Pong</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">ping</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="no">Pong</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="no">Pong</span> <span class="o">!</span> <span class="nb">exit</span><span class="p">,</span>
</span><span class='line'>  <span class="n">ok</span><span class="p">;</span>
</span><span class='line'><span class="n">ping</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="no">Pong</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="no">Pong</span> <span class="o">!</span> <span class="p">{</span><span class="nb">self</span><span class="p">(),</span> <span class="n">ping</span><span class="p">},</span>
</span><span class='line'>  <span class="n">receive</span>
</span><span class='line'>    <span class="n">pong</span> <span class="o">-&gt;</span>
</span><span class='line'>      <span class="ss">io</span><span class="p">:</span><span class="nb">format</span><span class="p">(</span><span class="s2">&quot;~w : pong [~w]~n&quot;</span><span class="p">,</span> <span class="o">[</span><span class="nb">self</span><span class="p">(),</span> <span class="n">N</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span><span class="p">,</span>
</span><span class='line'>  <span class="n">ping</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="no">Pong</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">pong</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="n">receive</span>
</span><span class='line'>    <span class="p">{</span><span class="no">From</span><span class="p">,</span> <span class="n">ping</span><span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>      <span class="ss">io</span><span class="p">:</span><span class="nb">format</span><span class="p">(</span><span class="s2">&quot;~w : ping~n&quot;</span><span class="p">,</span> <span class="o">[</span><span class="nb">self</span><span class="p">()</span><span class="o">]</span><span class="p">),</span>
</span><span class='line'>      <span class="no">From</span> <span class="o">!</span> <span class="n">pong</span><span class="p">,</span>
</span><span class='line'>      <span class="n">pong</span><span class="p">();</span>
</span><span class='line'>    <span class="nb">exit</span> <span class="o">-&gt;</span>
</span><span class='line'>      <span class="n">ok</span>
</span><span class='line'>  <span class="k">end</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Example running:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">1</span><span class="o">&gt;</span> <span class="n">c</span><span class="p">(</span><span class="n">pingpong</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span><span class="n">pingpong</span><span class="p">}</span>
</span><span class='line'><span class="mi">2</span><span class="o">&gt;</span> <span class="ss">pingpong</span><span class="p">:</span><span class="n">play</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">49</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">:</span> <span class="n">ping</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">39</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">:</span> <span class="n">pong</span> <span class="o">[</span><span class="mi">4</span><span class="o">]</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">49</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">:</span> <span class="n">ping</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">39</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">:</span> <span class="n">pong</span> <span class="o">[</span><span class="mi">3</span><span class="o">]</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">49</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">:</span> <span class="n">ping</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">39</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">:</span> <span class="n">pong</span> <span class="o">[</span><span class="mi">2</span><span class="o">]</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">49</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">:</span> <span class="n">ping</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">39</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span> <span class="p">:</span> <span class="n">pong</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'><span class="n">ok</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Timeout</strong><br/>
  Receive is a blocking statement; it blocks until a message that matches one of the clauses is placed in the incoming message queue. Erlang allows the programmer to explicitly unblock the receive statement using a timeout (if a matching message is not delivered until the timeout expires). The complete format of receive statement, including the after construct.
</p>




<p>
  Syntax:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">receive</span>
</span><span class='line'>  <span class="no">Pattern1</span> <span class="k">when</span> <span class="no">Guard1</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="no">ToDo1</span><span class="p">;</span>
</span><span class='line'>  <span class="no">Pattern2</span> <span class="k">when</span> <span class="no">Guard2</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="no">ToDo2</span><span class="p">;</span>
</span><span class='line'>  <span class="n">_Other</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="no">Catch_all</span>
</span><span class='line'><span class="n">after</span> <span class="no">Millisecs</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="no">ToDo_timeout</span><span class="p">;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Example:
</p>




<figure class='code'><figcaption><span>timeout.erl </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">-</span><span class="n">module</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'><span class="o">-</span><span class="n">export</span><span class="p">(</span><span class="o">[</span><span class="n">start</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sleep</span><span class="o">/</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">start</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="n">spawn</span><span class="p">(</span><span class="n">fun</span> <span class="n">timeout</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">timeout</span><span class="p">()</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="n">receive</span>
</span><span class='line'>    <span class="n">cancel</span> <span class="o">-&gt;</span>
</span><span class='line'>      <span class="ss">io</span><span class="p">:</span><span class="nb">format</span><span class="p">(</span><span class="s2">&quot;Timeout canceled~n&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">after</span> <span class="mi">2000</span> <span class="o">-&gt;</span> <span class="sx">% 2 </span><span class="n">seconds</span>
</span><span class='line'>    <span class="ss">io</span><span class="p">:</span><span class="nb">format</span><span class="p">(</span><span class="s2">&quot;Timeout triggered~n&quot;</span><span class="p">),</span>
</span><span class='line'>    <span class="n">timeout</span><span class="p">()</span>
</span><span class='line'>  <span class="k">end</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="o">%</span><span class="n">a</span> <span class="nb">sleep</span> <span class="n">function</span>
</span><span class='line'><span class="nb">sleep</span><span class="p">(</span><span class="no">Ms</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="ss">io</span><span class="p">:</span><span class="nb">format</span><span class="p">(</span><span class="s2">&quot;Sleeping for ~w ms~n&quot;</span><span class="p">,</span> <span class="o">[</span><span class="no">Ms</span><span class="o">]</span><span class="p">),</span>
</span><span class='line'>  <span class="n">receive</span>
</span><span class='line'>  <span class="n">after</span> <span class="no">Ms</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="n">done</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Example running:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">1</span><span class="o">&gt;</span> <span class="n">c</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'><span class="p">{</span><span class="n">ok</span><span class="p">,</span><span class="n">timeout</span><span class="p">}</span>
</span><span class='line'><span class="mi">2</span><span class="o">&gt;</span> <span class="n">P</span> <span class="o">=</span> <span class="ss">timeout</span><span class="p">:</span><span class="n">start</span><span class="p">()</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;</span><span class="mi">0</span><span class="o">.</span><span class="mi">42</span><span class="o">.</span><span class="mi">0</span><span class="o">&gt;</span>
</span><span class='line'><span class="no">Timeout</span> <span class="n">triggered</span>
</span><span class='line'><span class="no">Timeout</span> <span class="n">triggered</span>
</span><span class='line'><span class="mi">3</span><span class="o">&gt;</span> <span class="n">P</span> <span class="o">!</span> <span class="n">cancel</span><span class="o">.</span>
</span><span class='line'><span class="no">Timeout</span> <span class="n">canceled</span>
</span><span class='line'><span class="n">cancel</span>
</span><span class='line'><span class="mi">4</span><span class="o">&gt;</span> <span class="ss">timeout</span><span class="p">:</span><span class="nb">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'><span class="no">Sleeping</span> <span class="k">for</span> <span class="mi">1000</span> <span class="n">ms</span>
</span><span class='line'><span class="n">done</span>
</span><span class='line'><span class="mi">5</span><span class="o">&gt;</span> <span class="ss">timeout</span><span class="p">:</span><span class="nb">sleep</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'><span class="no">Sleeping</span> <span class="k">for</span> <span class="mi">3000</span> <span class="n">ms</span>
</span><span class='line'><span class="n">done</span>
</span></code></pre></td></tr></table></div></figure>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bunlong Van</span></span>

      








  


<time datetime="2015-01-27T23:07:00+07:00" pubdate data-updated="true">Jan 27<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/erlang/'>Erlang</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://geekhmer.github.io/blog/2015/01/27/erlang-message-passing/" data-via="" data-counturl="http://geekhmer.github.io/blog/2015/01/27/erlang-message-passing/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/01/26/erlang-concurrency/" title="Previous Post: Erlang Concurrency">&laquo; Erlang Concurrency</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/01/28/chicagoboss-installation/" title="Next Post: ChicagoBoss Installation">ChicagoBoss Installation &raquo;</a>
      
    </p>
  </footer>
</article>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/19/ruby-on-rails-web-console/">Ruby on Rails Web Console</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/18/hash-data-in-ruby/">Hash Data in Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/17/ruby-on-rails-export-csv/">Ruby on Rails Export CSV</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/16/how-to-build-a-sitemap-for-your-ruby-on-rails-application/">How to Build a Sitemap for Your Ruby on Rails Application</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/16/what-new-with-foreign-keys-in-rails-4-dot-2/">What New With Foreign Keys in Rails 4.2?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/16/ruby-on-rails-filter-vs-action/">Ruby on Rails _filter vs _action</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/16/quickly-add-bootstrap-to-your-project/">Quickly Add Bootstrap to Your Project</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Category</h1>
  <ul id="recent_posts">
    
      <li>
        <a href="/blog/categories/facebook/">Facebook [ 4 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby/">Ruby [ 72 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/heroku/">Heroku [ 2 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby-on-rails/">Ruby on rails [ 63 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/testing/">Testing [ 5 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/layout/">Layout [ 3 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby-metaprogramming/">Ruby metaprogramming [ 4 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/websocket/">Websocket [ 2 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/front-end-mvc-framework/">Front-end mvc framework [ 1 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/javascript/">Javascript [ 3 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/erlang/">Erlang [ 20 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/design-pattern/">Design pattern [ 1 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/other/">Other [ 18 ]</a>
      </li>
    
  </ul>
</section><section>
  <h1>Notes</h1>
  <ul id="recent_posts">
    <li>
      <a href="http://vimcommands.github.io/" target="_blank">Vim Commands</a>
    </li>
    <li>
      <a href="http://ruby-hacking-style-guide.github.io/" target="_blank">Ruby Hacking Style Guide</a>
    </li>
  </ul>
</section><section>
  <h1>References</h1>
  <ul id="recent_posts">
    <li>
      <a href="http://www.erlang.org/" target="_blank">
        <img src="/images/logo_erlang.png" />
      </a>
    </li>
    <li>
      <a href="http://www.chicagoboss.org/" target="_blank">
        <img src="/images/logo_chicagoboss.svg" />
      </a>
    </li>
    <li>
      <a href="https://www.ruby-lang.org/en/" target="_blank">
        <img src="/images/logo_ruby.png" />
      </a>
    </li>
    <li>
      <a href="http://guides.rubyonrails.org" target="_blank">
        <img src="/images/logo_rails_guides.png" />
      </a>
    </li>
    <li>
      <a href="http://railscasts.com" target="_blank">
        <img src="/images/logo_rails_casts.png" />
      </a>
    </li>
    <li>
      <a href="https://github.com" target="_blank">
        <img src="/images/logo_github.png" />
      </a>
    </li>
    <li>
      <a href="https://www.linode.com" target="_blank">
        <img src="/images/logo_linode.png" />
      </a>
    </li>
    <li>
      <a href="http://newrelic.com" target="_blank">
        <img src="/images/logo_newrelic.png" />
      </a>
    </li>
    <li>
      <a href="https://developers.facebook.com/" target="_blank">
        <img src="/images/logo_facebook.png" />
      </a>
    </li>
  </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 GeeKhmer in Phnom Penh, Cambodia.
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=1451301955117043&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

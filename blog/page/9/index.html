
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>GeeKhmer</title>
  <meta name="author" content="Bunlong Van">
  
  
  <meta name="description" content="The biggest website of computer programming, Ruby, Ruby on Rails, Erlang, Chicagoboss and Javascript in Southeast Asia.">

  <meta name="keywords" content="geekhmer,khmer,cambodia,geek khmer,khmer geek,geek cambodia,cambodia geek,hacker,khmer hacker,hacker khmer,hacking,coding,programming,testing,Ruby,Ruby khmer,khmer Ruby,Rubyist,khmer Rubyist,Rubyist khmer,Rubyist cambodia,cambodia Rubyist,Ruby on Rails,Ruby on Rails khmer,khmer Ruby on Rails,Cambodia Ruby,Ruby Cambodia,Cambodia Ruby on Rails,Ruby on Rails Cambodia,RSpec TDD,RSpec BDD,facebook,computer general,networking,Chicagoboss,erlang,Erlang,Khmer Chicagoboss, Chicagoboss Khmer,Cambodia Chicagoboss,Chicagoboss Cambodia,Khmer Erlang,Erlang Khmer,Cambodia Erlang, Erlang Cambodia, Ruby southeast asia, Ruby on Rails southeast asia">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://geekhmer.github.io/blog/page/9">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="GeeKhmer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<link href="/stylesheets/jquery.fancybox.css" media="screen, projection" rel="stylesheet" type="text/css">
<script src="/javascripts/libs/jquery.fancybox.pack.js"></script>
<script src="/javascripts/init_fancybox.js"></script>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1>
    <!-- <a href="/">GeeKhmer</a> -->
    <div class="logo" />
  </h1>
  
</hgroup>

</header>
  <nav role="navigation">
  <form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:geekhmer.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
  </form>

<ul class="subscription" data-subscription="rss">
  
  
</ul>
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Articles</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/team">Team</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/04/10-reasons-you-should-design-and-code/">10 Reasons You Should Design and Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-04T00:43:00+07:00" pubdate data-updated="true">Jul 4<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/design_and_code.jpg" width="430" alt="10 Reasons You Should Design and Code" />
</p>




<p>
  <strong>1. Higher Pay</strong><br/>
  By knowing how to design and code, you’ll be worth more to companies. Especially startups! By not only knowing how to design a beautiful UI element, but also implement what you design, you’ll be able work faster and create better work. All of which makes you more valuable and able to demand a higher salary.
</p>




<p>
  <strong>2. More Opportunities</strong><br/>
  Not only will you make more money, but you won’t have a problem getting a job. Your skill set is so rare that everyone will be trying to snatch you up! Startups especially, because they have smaller teams and less resources, a employee who is able to do more than one thing (design and code) is almost a must. Everyone will be fighting over you!
</p>




<p>
  <strong>3. Start Your Own Company</strong><br/>
  One of the reasons these designer/developer combos (Unicorns) are so rare is because they’re usually busy starting their own companies. When you have the knowledge to not only develop a application, but also make it beautiful, you have everything (almost) you need to launch any idea you have!
</p>




<p>
  <strong>4. Freedom</strong><br/>
  There is an incredible freedom that comes from not having to rely on someone else to take care of a part of your project. You can allow someone else to do the design, or the development, but by being able to design & code you have the ability to do it yourself. Freedom!
</p>




<p>
  <strong>5. Build from Start to Finish</strong><br/>
  By knowing how to do both the design and the development of a project, you have the ability to take an idea from concept to completion all by yourself. This also gives you greater control over the outcome of the project because you make every decision. This brings me to my next point:
</p>




<p>
  <strong>6. Experimentation</strong><br/>
  Since you can build both sides of any given project, you won’t need to hire someone else to do either the design or the development. This means it won’t cost you thousands of dollars, or a percentage of your project or company ownership, just to validate the idea. Putting a project out and seeing if it gains any traction costs nothing more than your time… Which of course means you can put out more work! It’s experimentation without the risk.
</p>




<p>
  <strong>7. Work More Efficiently</strong><br/>
  Design & code go hand in hand. They’re so tightly integrated that it’s important to know what is possible on both sides. By knowing how to design & how to code you can make smart decision about one side that would later effect the other.
</p>




<p>
  <strong>8. Higher Quality of Work</strong><br/>
  There are so many decisions that are made between the initial concept and launch. It’s very easy for things to get lost in the communication between the designer and the developer. By knowing how to design and code you can make smart decisions for both sides as you work, leading to a higher quality end product.
</p>




<p>
  <strong>9. Work Better on a Team</strong><br/>
  As I mentioned in the previous point, you’ll know what both sides need. This means when you are working with another designer or another developer, you can avoid making decisions that will negatively affect the other side. For example, a designer creating a UI element that he/she thinks (wrongly assuming) will be simple to implement, but not fully understanding the effort it will take to create it. (I did this when I was only a designer… I designed something assuming it wouldn’t be too much work only to find out from he developer it was very complicated. All of which could have been avoided if I understood what it took to do the development).
</p>




<p>
  <strong>10. Make a Better Leader</strong><br/>
  So not only will you make a great team member, but you’ll also make a great team leader. You’ll have the understanding and empathy you need because you know what is required to do this work. You know if a project timeline could happen quicker, but you also know if the deadline is unrealistic because you’ve been there.
</p>




<p>
  So far so good, That&#8217;s it!!! See ya!!! :)
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/30/angularjs-on-rails/">AngularJS on Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-30T23:43:00+07:00" pubdate data-updated="true">Jun 30<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/angularjs_on_rails.png" width="400" alt="AngularJS on Rails" />
</p>




<p>
  AngularJS is an extremely popular JavaScript library that enables you to quickly and easily create rich web applications. In this article we will show you how to integrate AngularJS with your Rails app. We will also build a simple AngularJS application called VisitorsCenter. The VisitorsCenter application allows the user to track visitors that are coming and going from a building such as an office building. 
</p>




<p>
  <strong>Setup Rails Application</strong><br/>
  Before we begin, we will need to add a couple gems to our Gemfile. The <code>angularJs-rails</code> gem provides integration with the AngularJS library and our Rails application. The bootstrap-sass gem merely adds bootstrap support so we can focus on the code rather than the style of the app. Add these gems to your gemfile now as listed below.
</p>




<figure class='code'><figcaption><span>Gemfile </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;angularjs-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.2.25&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;bootstrap-sass&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.2.0.2&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Now run a bundle install to install the gems:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="n">install</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Next, we need to create a model called <code>Visitor</code>. The <code>Visitor</code> model will represent a visitor that visits. Run the command below to create the visitor model now:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Visitor</span> <span class="n">first_name</span><span class="ss">:string</span> <span class="n">last_name</span><span class="ss">:string</span> <span class="ss">reason</span><span class="p">:</span><span class="n">string</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Great, now we need to create a <code>Visitors</code> controller that will give us a way to interact with our model. The <code>Visitors</code> controller will have 3 different actions in this example application. The first action, <code>index</code> will return either the visitors page or a json list of visitors depending on how it is accessed. The second action, <code>create</code> will be responsible for creating the visitor. The final action, <code>destroy</code> will destroy the visitor. Run the command below to create this controller now:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="no">Visitors</span> <span class="n">index</span> <span class="n">create</span> <span class="n">destroy</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Now let&#8217;s modify our routes file to set up the proper paths and add a site root. Open up your routes file and modify it so that it looks like the code listed below:
</p>




<figure class='code'><figcaption><span>routes.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:visitors</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span><span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span><span class="p">}</span>
</span><span class='line'>  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s2">&quot;visitors#index&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The code fragment that says <code>defaults: {format: :json}</code> tells Rails that we wish to return json by default for our actions. We do this because most of the interaction in our application will be via JSON.
</p>




<p>
  By default, AngularJS knows nothing of the cross site request forgery (CSRF) protections in our applications. We need a way to tell AngularJS how to interact with our application while obeying the CSRF protections that we have in place. Luckily we have a way to do this. Open up your <code>ApplicationController</code> and add in the code listed below.
</p>




<p>
  If you are using Rails 4.2 and up, use the code below:
</p>




<figure class='code'><figcaption><span>application_controller.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="ss">ActionController</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">protect_from_forgery</span> <span class="ss">with</span><span class="p">:</span> <span class="ss">:exception</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">after_action</span> <span class="ss">:set_csrf_cookie_for_ng</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">set_csrf_cookie_for_ng</span>
</span><span class='line'>    <span class="n">cookies</span><span class="o">[</span><span class="s1">&#39;XSRF-TOKEN&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">form_authenticity_token</span> <span class="k">if</span> <span class="n">protect_against_forgery?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">protected</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">verified_request?</span>
</span><span class='line'>    <span class="k">super</span> <span class="o">||</span> <span class="n">valid_authenticity_token?</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;X-XSRF-TOKEN&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  If you are still using Rails 4.1, use the code below instead:
</p>




<figure class='code'><figcaption><span>application_controller.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="ss">ActionController</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">protect_from_forgery</span> <span class="ss">with</span><span class="p">:</span> <span class="ss">:exception</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">after_action</span> <span class="ss">:set_csrf_cookie_for_ng</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">set_csrf_cookie_for_ng</span>
</span><span class='line'>    <span class="n">cookies</span><span class="o">[</span><span class="s1">&#39;XSRF-TOKEN&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">form_authenticity_token</span> <span class="k">if</span> <span class="n">protect_against_forgery?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">protected</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">verified_request?</span>
</span><span class='line'>    <span class="k">super</span> <span class="o">||</span> <span class="n">form_authenticity_token</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s1">&#39;X-XSRF-TOKEN&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The code listed above will create a cookie called <code>XSRF-TOKEN</code> that will contain our <code>form_authenticity_token</code>. Any time a request is made, AngularJS will present that token in the HTTP headers for the request.
</p>




<p>
  Now let&#8217;s modify our <code>VisitorsController</code> to allow for access to the <code>Visitor</code> model. Open up your <code>VisitorsController</code> and modify it so that it looks like the code listed below:
</p>




<figure class='code'><figcaption><span>visitors_controller.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">VisitorsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="ss">:json</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="no">Visitor</span><span class="o">.</span><span class="n">all</span> <span class="p">}</span>
</span><span class='line'>      <span class="nb">format</span><span class="o">.</span><span class="n">html</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="n">respond_with</span> <span class="no">Visitor</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">visitor_params</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>    <span class="n">respond_with</span> <span class="no">Visitor</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">visitor_params</span>
</span><span class='line'>    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:visitor</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:last_name</span><span class="p">,</span> <span class="ss">:reason</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The code above is typical Rails code, with the exception being that we return JSON as a result. Since our application will be communicating primarily via AJAX we have no need for HTML other than the index action, which will return either html or json depending on the request type.
</p>




<p>
  Next we need to add support for both AngularJS and Bootstrap to our application.js file. Open up your application.js file and modify it so that it looks like the code listed below.
</p>




<figure class='code'><figcaption><span>application.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">jquery</span>
</span><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">jquery_ujs</span>
</span><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">turbolinks</span>
</span><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">angular</span>
</span><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">angular</span><span class="o">-</span><span class="n">resource</span>
</span><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="nb">require</span> <span class="n">bootstrap</span><span class="o">-</span><span class="n">sprockets</span>
</span><span class='line'><span class="sr">//</span><span class="o">=</span> <span class="n">require_tree</span> <span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  In the code above we add support for AngularJS as well as Bootstrap. We also add support for a library called <code>angular-resource</code> which allows us to easily talk to our Rails application.
</p>




<p>
  Now let&#8217;s add a bit of CSS for bootstrap. Create a new file called <code>bootstrap_config</code>.scss and add in the code listed below:
</p>




<figure class='code'><figcaption><span>bootstrap_config.scss </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@import</span> <span class="s2">&quot;bootstrap-sprockets&quot;</span><span class="p">;</span>
</span><span class='line'><span class="vi">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The next thing we need to do is create our AngularJS application. AngularJS applications typically consists of JavaScript code that glues together various bits of HTML. To get started doing this, the first thing we must do is rename our <code>visitors.js.coffee</code> file to <code>visitors.js</code> and modify it so that it looks like the code listed below. You can also rewrite this in CoffeeScript, but I use JavaScript for those that haven&#8217;t yet learned CoffeeScript.
</p>




<figure class='code'><figcaption><span>visitors.js </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">var</span> <span class="n">visitorCenter</span> <span class="o">=</span> <span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">&#39;VisitorCenter&#39;</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;ngResource&#39;</span><span class="o">]</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">visitorCenter</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;Visitor&quot;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="vg">$resource</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="vg">$resource</span><span class="p">(</span><span class="s2">&quot;visitors/:id&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">&#39;@id&#39;</span> <span class="p">},</span> <span class="p">{</span>
</span><span class='line'>    <span class="ss">index</span><span class="p">:</span>   <span class="p">{</span> <span class="nb">method</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="ss">isArray</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">responseType</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span> <span class="p">},</span>
</span><span class='line'>    <span class="ss">update</span><span class="p">:</span>  <span class="p">{</span> <span class="nb">method</span><span class="p">:</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="ss">responseType</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="n">visitorCenter</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s2">&quot;visitorsController&quot;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="vg">$scope</span><span class="p">,</span> <span class="no">Visitor</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="vg">$scope</span><span class="o">.</span><span class="n">visitors</span> <span class="o">=</span> <span class="no">Visitor</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="vg">$scope</span><span class="o">.</span><span class="n">addVisitor</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">visitor</span> <span class="o">=</span> <span class="no">Visitor</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="vg">$scope</span><span class="o">.</span><span class="n">newVisitor</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="vg">$scope</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">visitor</span><span class="p">)</span>
</span><span class='line'>    <span class="vg">$scope</span><span class="o">.</span><span class="n">newVisitor</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="vg">$scope</span><span class="o">.</span><span class="n">deleteVisitor</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">visitor</span> <span class="o">=</span> <span class="vg">$scope</span><span class="o">.</span><span class="n">visitors</span><span class="o">[</span><span class="n">index</span><span class="o">]</span>
</span><span class='line'>    <span class="no">Visitor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">visitor</span><span class="p">)</span>
</span><span class='line'>    <span class="vg">$scope</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">splice</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  There is a lot going on here, so i&#8217;m going to break it down into pieces. The first line:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">var</span> <span class="n">visitorCenter</span> <span class="o">=</span> <span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">&#39;VisitorCenter&#39;</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;ngResource&#39;</span><span class="o">]</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  defines an AngularJS module. AngularJS modules can be thought of as individual components in your application. You&#8217;ll notice we include <code>ngResource</code> as an argument. <code>ngResource</code> provides easy access to RESTful resources such as our Rails application.
</p>




<p>
  The next set of lines:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">visitorCenter</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;Visitor&quot;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="vg">$resource</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="vg">$resource</span><span class="p">(</span><span class="s2">&quot;visitors/:id&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">&#39;@id&#39;</span> <span class="p">},</span> <span class="p">{</span>
</span><span class='line'>    <span class="ss">index</span><span class="p">:</span>   <span class="p">{</span> <span class="nb">method</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="ss">isArray</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">responseType</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span> <span class="p">},</span>
</span><span class='line'>    <span class="ss">update</span><span class="p">:</span>  <span class="p">{</span> <span class="nb">method</span><span class="p">:</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="ss">responseType</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  defines a service, in this case, it ties in the <code>ngResource</code> service mentioned earlier and tells AngularJS how to talk to our application.
</p>




<p>
  The next set of lines:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">visitorCenter</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s2">&quot;visitorsController&quot;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="vg">$scope</span><span class="p">,</span> <span class="no">Visitor</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="vg">$scope</span><span class="o">.</span><span class="n">visitors</span> <span class="o">=</span> <span class="no">Visitor</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>  <span class="vg">$scope</span><span class="o">.</span><span class="n">addVisitor</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">visitor</span> <span class="o">=</span> <span class="no">Visitor</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="vg">$scope</span><span class="o">.</span><span class="n">newVisitor</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="vg">$scope</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">visitor</span><span class="p">)</span>
</span><span class='line'>    <span class="vg">$scope</span><span class="o">.</span><span class="n">newVisitor</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="vg">$scope</span><span class="o">.</span><span class="n">deleteVisitor</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">visitor</span> <span class="o">=</span> <span class="vg">$scope</span><span class="o">.</span><span class="n">visitors</span><span class="o">[</span><span class="n">index</span><span class="o">]</span>
</span><span class='line'>    <span class="no">Visitor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">visitor</span><span class="p">)</span>
</span><span class='line'>    <span class="vg">$scope</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">splice</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  define a controller. Controllers tell AngularJS how to interact with our application similar to how Rails controllers are used to tell Rails how our views interact with our models.
</p>




<p>
  ow that we&#8217;ve written the JavaScript application, we need to create our view to tie everything together. Open up the index view for your <code>Visitors</code> controller and modify it so that it looks like the code listed below:
</p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;div class="container" ng-app="VisitorCenter"&gt;
</span><span class='line'>  &lt;h1&gt;Visitors&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>  &lt;div ng-controller="visitorsController"&gt;
</span><span class='line'>    &lt;div class="well"&gt;
</span><span class='line'>      &lt;h3&gt;Add a new Visitor&lt;/h3&gt;
</span><span class='line'>      &lt;form ng-submit="addVisitor()"&gt;
</span><span class='line'>        &lt;div class="row"&gt;
</span><span class='line'>          &lt;div class="col-xs-6"&gt;
</span><span class='line'>            &lt;input type="text" ng-model="newVisitor.first_name" class="form-control" placeholder="First Name" /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>          &lt;div class="col-xs-6"&gt;
</span><span class='line'>            &lt;input type="text" ng-model="newVisitor.last_name" class="form-control" placeholder="Last Name" /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>        &lt;div class="row"&gt;
</span><span class='line'>          &lt;div class="col-xs-12"&gt;
</span><span class='line'>            &lt;br /&gt;
</span><span class='line'>            &lt;input type="text" ng-model="newVisitor.reason" class="form-control" placeholder="Reason for Visit" /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>        &lt;div class="row"&gt;
</span><span class='line'>          &lt;div class="col-xs-12 text-center"&gt;
</span><span class='line'>            &lt;br /&gt;
</span><span class='line'>            &lt;input type="Submit" value="Add Visitor" class="btn btn-primary" /&gt;
</span><span class='line'>          &lt;/div&gt;
</span><span class='line'>        &lt;/div&gt;
</span><span class='line'>      &lt;/form&gt;
</span><span class='line'>    &lt;/div&gt;
</span><span class='line'>
</span><span class='line'>    &lt;h3&gt;Currently Visiting&lt;/h3&gt;
</span><span class='line'>    &lt;hr /&gt;
</span><span class='line'>    &lt;table class="table table-bordered table-striped"&gt;
</span><span class='line'>      &lt;thead&gt;
</span><span class='line'>        &lt;tr&gt;
</span><span class='line'>          &lt;th&gt;First Name&lt;/th&gt;
</span><span class='line'>          &lt;th&gt;Last Name&lt;/th&gt;
</span><span class='line'>          &lt;th&gt;Reason for Visit&lt;/th&gt;
</span><span class='line'>          &lt;th&gt;&nbsp;&lt;/th&gt;
</span><span class='line'>        &lt;/tr&gt;
</span><span class='line'>      &lt;/thead&gt;
</span><span class='line'>      &lt;tbody&gt;
</span><span class='line'>        &lt;tr ng-show="!visitors.length"&gt;
</span><span class='line'>          &lt;td colspan="4"&gt;No visitors in the building.&lt;/td&gt;
</span><span class='line'>        &lt;/tr&gt;
</span><span class='line'>        &lt;tr ng-repeat="visitor in visitors"&gt;
</span><span class='line'>          &lt;td&gt;{{ visitor.first_name }}&lt;/td&gt;
</span><span class='line'>          &lt;td&gt;{{ visitor.last_name }}&lt;/td&gt;
</span><span class='line'>          &lt;td&gt;{{ visitor.reason }}&lt;/td&gt;
</span><span class='line'>          &lt;td&gt;&lt;a class="btn btn-danger" ng-click="deleteVisitor($index)"&gt;Remove&lt;/a&gt;&lt;/td&gt;
</span><span class='line'>        &lt;/tr&gt;
</span><span class='line'>      &lt;/tbody&gt;
</span><span class='line'>    &lt;/table&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>&lt;/div&gt;</span></code></pre></td></tr></table></div></figure>




<p>
  Let&#8217;s break this down a bit:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span> <span class="n">ng</span><span class="o">-</span><span class="n">app</span><span class="o">=</span><span class="s2">&quot;VisitorCenter&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The outer div on the first line has an attribute called <code>ng-app</code>. The <code>ng-app</code> attribute tells AngularJS that this is part of our AngularJS application. In this case we specify the name of our AngularJS module, <code>VisitorCenter</code>.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">ng</span><span class="o">-</span><span class="n">controller</span><span class="o">=</span><span class="s2">&quot;visitorsController&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The next inner div contains an attribute called <code>ng-controller</code>. This attribute tells AngularJS that we wish to use our visitorsController as the controller for this portion of the application.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">form</span> <span class="n">ng</span><span class="o">-</span><span class="n">submit</span><span class="o">=</span><span class="s2">&quot;addVisitor()&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-xs-6&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">ng</span><span class="o">-</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;newVisitor.first_name&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;First Name&quot;</span> <span class="sr">/&gt;</span>
</span><span class='line'><span class="sr">    &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-xs-6&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">ng</span><span class="o">-</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;newVisitor.last_name&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Last Name&quot;</span> <span class="sr">/&gt;</span>
</span><span class='line'><span class="sr">    &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr">  &lt;div class=&quot;row&quot;&gt;</span>
</span><span class='line'><span class="sr">    &lt;div class=&quot;col-xs-12&quot;&gt;</span>
</span><span class='line'><span class="sr">      &lt;br /</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">ng</span><span class="o">-</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;newVisitor.reason&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Reason for Visit&quot;</span> <span class="sr">/&gt;</span>
</span><span class='line'><span class="sr">    &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr">  &lt;div class=&quot;row&quot;&gt;</span>
</span><span class='line'><span class="sr">    &lt;div class=&quot;col-xs-12 text-center&quot;&gt;</span>
</span><span class='line'><span class="sr">      &lt;br /</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s2">&quot;Submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Add Visitor&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;btn btn-primary&quot;</span> <span class="sr">/&gt;</span>
</span><span class='line'><span class="sr">    &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The <code>ng-submit</code> attribute on our form tells AngularJS that we wish to use the addVisitor() method on our controller to process the form request. Each of the input elements contain an <code>ng-model</code> attribute. This attribute maps the input elements to our model.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">tr</span> <span class="n">ng</span><span class="o">-</span><span class="n">show</span><span class="o">=</span><span class="s2">&quot;!visitors.length&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s2">&quot;4&quot;</span><span class="o">&gt;</span><span class="no">No</span> <span class="n">visitors</span> <span class="k">in</span> <span class="n">the</span> <span class="n">building</span><span class="o">.</span><span class="n">&lt;</span><span class="sr">/td&gt;</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The <code>ng-show</code> attribute on the first row tells AngularJS that we only want to show the row if the condition mentioned is matched. In this case we only want to show the first row if there are no visitors.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">tr</span> <span class="n">ng</span><span class="o">-</span><span class="n">repeat</span><span class="o">=</span><span class="s2">&quot;visitor in visitors&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/tr&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The <code>ng-repeat</code> attribute is a loop. This particular loop tells AngularJS that we want to loop through each visitor.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">visitor</span><span class="o">.</span><span class="n">first_name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="sr">/td&gt;</span>
</span><span class='line'><span class="sr">&lt;td&gt;{{ visitor.last_name }}&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">visitor</span><span class="o">.</span><span class="n">reason</span> <span class="p">}}</span><span class="o">&lt;</span><span class="sr">/td&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Text contained within <code>{{ .... }}</code> are AngularJS expressions. In this case we are telling AngularJS to render the fields mentioned in each expression.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;btn btn-danger&quot;</span> <span class="n">ng</span><span class="o">-</span><span class="n">click</span><span class="o">=</span><span class="s2">&quot;deleteVisitor($index)&quot;</span><span class="o">&gt;</span><span class="no">Remove</span><span class="o">&lt;</span><span class="sr">/a&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The <code>ng-click</code> button tells AngularJS to run the specified controller function when the html tag in question is clicked. In this case we run the code to delete the specified user.
</p>




<p>
  So far so good, That&#8217;s it!!! for this introduction to AngularJS and Rails. See ya!!! :)
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/25/mark-methods-private-when-you-dont-test-them/">Mark Methods Private When You Don’t Test Them</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-25T20:58:00+07:00" pubdate data-updated="true">Jun 25<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/happy_ruby_on_rails.jpg" width="400" alt="Mark Methods Private When You Don’t Test Them" />
</p>




<p>
  In Ruby and many other languages, you write private methods to implement internal logic you don’t want to expose. You want the freedom to rename, repurpose or even delete them without worrying about impacting anything else. The <code>private</code> keyword signals other developers: Don’t rely on this; don’t call it; it might change. This is especially important when writing framework or library code that many other developers will use.
</p>




<p>
  But which methods should you make private? Sometimes this is obvious; sometimes it isn&#8217;t. A good rule of thumb to use is: If you’re not testing a method, it should be private.
</p>




<p>
  But wait a minute! Aren&#8217;t we supposed to test everything? Isn&#8217;t 100% code coverage the every Ruby developer seeks? Let me clarify. You should mark methods private when you test them indirectly by calling the other, public methods in the same class. Use the <code>private</code> keyword to help organize your code, to remind yourself what you still need to test, and what you don&#8217;t.
</p>




<p>
  <strong>Three Paintings</strong><br/>
  A simple example will make this clear. Suppose I have a class that describes a painting:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Painting</span> <span class="o">=</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:year</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Now I can create a list of three paintings in a Minitest::Spec file like this:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">let</span><span class="p">(</span><span class="ss">:one</span><span class="p">)</span> <span class="p">{</span> <span class="no">Painting</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Spanish Couple In Front Of Inn&quot;</span><span class="p">,</span> <span class="mi">1900</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="n">let</span><span class="p">(</span><span class="ss">:two</span><span class="p">)</span> <span class="p">{</span> <span class="no">Painting</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Guernica&quot;</span><span class="p">,</span> <span class="mi">1937</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="n">let</span><span class="p">(</span><span class="ss">:three</span><span class="p">)</span> <span class="p">{</span> <span class="no">Painting</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Petite Fleurs&quot;</span><span class="p">,</span> <span class="mi">1958</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="n">let</span><span class="p">(</span><span class="ss">:paintings</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">three</span><span class="o">]</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Suppose my first requirement is to return the first painting from the list. Simple enough:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">list</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;should return the first element&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">first</span><span class="p">(</span><span class="n">paintings</span><span class="p">)</span><span class="o">.</span><span class="n">must_equal</span> <span class="n">one</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  I just call Array#first and I’m done. Returning the rest of the list is slightly more interesting:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">rest</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">list</span>
</span><span class='line'>  <span class="n">rest</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the rest of the elements&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">rest</span><span class="p">(</span><span class="n">paintings</span><span class="p">)</span><span class="o">.</span><span class="n">must_equal</span> <span class="o">[</span><span class="n">two</span><span class="p">,</span> <span class="n">three</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Rest always returns an array even if the input list was empty or had only one element. So far, so good. I’ve written two methods and two tests:
</p>




<p>
  <img src="/images/two_tests.png" width="400" alt="Mark Methods Private When You Don’t Test Them" />
</p>




<p>
  <strong>A New Requirement</strong><br/>
  Now suppose my business requirement changes slightly and I instead need to return the first painting sorted alphabetically by name. Once again, it’s not hard to do:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">list</span><span class="o">.</span><span class="n">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="o">|</span>
</span><span class='line'>    <span class="n">p1</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;=&gt;</span> <span class="n">p2</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>  <span class="k">end</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;should return the first element&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">first</span><span class="p">(</span><span class="n">paintings</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">must_equal</span> <span class="s2">&quot;Guernica&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  And I need rest to use the same sort order, so I repeat the call to sort:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">rest</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="n">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="o">|</span>
</span><span class='line'>    <span class="n">p1</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;=&gt;</span> <span class="n">p2</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">rest</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the rest of the elements&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">rest</span><span class="p">(</span><span class="n">paintings</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">must_equal</span> <span class="o">[</span>
</span><span class='line'>    <span class="s2">&quot;Petite Fleurs&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Spanish Couple In Front Of Inn&quot;</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  I’ve implemented new behavior, but still have two methods and two tests:
</p>




<p>
  <img src="/images/two_tests.png" width="400" alt="Mark Methods Private When You Don’t Test Them" />
</p>




<p>
  <strong>Extracting a Method</strong><br/>
  Because both of my methods are covered by tests, I’m free to refactor them. I decide to extract a new method, sorted_by_name:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sorted_by_name</span><span class="p">(</span><span class="n">list</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">rest</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">sorted_by_name</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">rest</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">sorted_by_name</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">list</span><span class="o">.</span><span class="n">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="o">|</span>
</span><span class='line'>    <span class="n">p1</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;=&gt;</span> <span class="n">p2</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the element with the first name&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">first</span><span class="p">(</span><span class="n">paintings</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">must_equal</span> <span class="s2">&quot;Guernica&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the rest after the first name&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">rest</span><span class="p">(</span><span class="n">paintings</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">must_equal</span> <span class="o">[</span>
</span><span class='line'>    <span class="s2">&quot;Petite Fleurs&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Spanish Couple In Front Of Inn&quot;</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Here I’ve simply moved the call to sort into a utility method called sorted_by_name. Now first and rest both call sorted_by_name, making the code a bit clearer and DRY-er. But now I have three methods and only two tests:
</p>




<p>
  <img src="/images/two_tests_three_methods.png" width="400" alt="Mark Methods Private When You Don’t Test Them" />
</p>




<p>
  <strong>Mark Methods Private When You Don’t Test Them</strong><br/>
  Notice I didn’t bother writing a test for sorted_by_name. I know it works because my other tests still pass. The existing tests are sufficient; I am testing sorted_by_name indirectly. Because I extracted sorted_by_name from first and rest, because I refactored my code without adding any new behavior, no new test were required.
</p>




<p>
  In this scenario, take the time to mark the new, untested method as private:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sorted_by_name</span><span class="p">(</span><span class="n">list</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">rest</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span> <span class="o">=</span> <span class="n">sorted_by_name</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">rest</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="kp">private</span>
</span><span class='line'><span class="k">def</span> <span class="nf">sorted_by_name</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
</span><span class='line'>  <span class="n">list</span><span class="o">.</span><span class="n">sort</span> <span class="k">do</span> <span class="o">|</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="o">|</span>
</span><span class='line'>    <span class="n">p1</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;=&gt;</span> <span class="n">p2</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the element with the first name&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">first</span><span class="p">(</span><span class="n">paintings</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">must_equal</span> <span class="s2">&quot;Guernica&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the rest after the first name&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">rest</span><span class="p">(</span><span class="n">paintings</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">must_equal</span> <span class="o">[</span>
</span><span class='line'>    <span class="s2">&quot;Petite Fleurs&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;Spanish Couple In Front Of Inn&quot;</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The private keyword here reminds me I’ve already tested sorted_by_name, that I don’t need to write new tests for it. Now private is helping me organize my code; it’s helping me remember which methods I don’t need to test… and which methods are missing important tests.
</p>




<p>
  <img src="/images/two_tests_three_methods_private.png" width="400" alt="Mark Methods Private When You Don’t Test Them" />
</p>




<p>
  f my tests don’t need to know about sorted_by_name, then certainly other developers don’t. It should be private. Marking it private reminds me that it is being tested indirectly, that I didn’t just forget to write a test for it. Marking it private tells other developers about what I’ve learned from my own test suite.
</p>




<p>
  So far so good, That&#8217;s it!!! See ya!!! :)
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/21/use-message-queue-in-rails/">Use Message Queue in Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-21T10:53:00+07:00" pubdate data-updated="true">Jun 21<span>st</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/message_queue .png" width="400" alt="Use Message Queue in Rails" />
</p>




<p>
  This article describes the application architecture pattern which is (in general) nothing new, but (from my experience) rarely applied in the Rails world. I’m talking about the nice and simple abstraction – message queue. But let me start by describing the goals I want to achieve and some alternative solutions.
</p>




<h3>
  Goals
</h3>




<p>
  <strong>Split</strong> application into a few smaller applications<br/>
  Smaller applications are easier to reason about. You don’t have to go through 50 classes, you can just read 10, because it’s all you’ve got. When a new developer joins the team he has nice onboarding if you can tell him: “hey, start with this small piece of code, everything you need to know to implement this new feature is encapsulated here”.
</p>




<p>
  <strong>Separate</strong> code for concepts which are not logically connected<br/>
  Smaller applications are easier to reason about. You don’t have to go through 50 classes, you can just read 10, because it’s all you’ve got. When a new developer joins the team he has nice onboarding if you can tell him: &#8220;hey, start with this small piece of code, everything you need to know to implement this new feature is encapsulated here&#8221;.
</p>




<p>
  Use <strong>new</strong> languages and frameworks<br/>
  We, developers, want to try and learn new languages, libraries, frameworks and technologies. If you make a small application with a shiny new tool and fail – the consequences are less severe, because you can quickly rewrite this small application. If you are going to make one big application, you will think twice before introducing a new tool. So, in some way, smaller applications minimize the risk.
</p>




<h3>
  Solution1 - One database, multiple apps
</h3>




<p>
  This is the very first idea which may come to your mind – just point multiple applications to the one shared database. Been there, done that, won’t do that again! Data is associated with validation logic. Either you duplicate this logic in every app or you extract it to Rails engine gem. Both solutions are hard to maintain (think about running migrations…) and you still have strong coupling in your system.
</p>




<p>
  One case when this approach may work – one read-write app and many read-only apps, but I haven’t tried it.
</p>




<h3>
  Solution2 - Expose REST API
</h3>




<p>
  As Rails devs we are pretty familiar with REST, so we can expose REST API in one of our apps and call this API in the other. This approach has many solid use cases so here I’m just listing some weak points to take into consideration:
</p>




<p>
  - Usually requests in Ruby are blocking – calling app has to wait for the response even if it’s not interested in it.<br/>
  - Requires authentication – we have to somehow ensure that our internal API is not used… well, externally.<br/>
  - Everything happens in server process – if you are calling your internal API you may end up using the same server process which is used for handling requests of your “real users”. You would like to give your “real users” priority.<br/>
  - Calling app has knowledge about receiving app – you have to know which endpoints should be called and which parameters be passed. This introduces coupling.<br/>
</p>




<h3>
  Solution3 - Message queue
</h3>




<p>
  Message queue is a really nice abstraction. Publisher just leaves messages at one end of the &#8220;pipe&#8221;, consumer reads messages from the other end of the &#8220;pipe&#8221;. It is asynchronous, because publisher does not wait for his message to be processed. Moreover, it decouples publisher from consumer, because publisher does not care what happens with his message and who will read it.
</p>




<p>
  This architecture is also resistant to outages, at least when we assume that the queue service rarely breaks. If the consumer is not processing messages, nothing prevents publisher from adding more of them to the queue. When consumer starts to function again, it will process messages from the buffer (if they didn’t take all of your memory).
</p>




<h3>
  When it shines?
</h3>




<p>
  Message queue is really useful if we have some processing which happens out of the main business flow and the main business flow does not have to wait for the results of this processing. The most common example is custom event tracking – own analytics module. We just publish an event and continue execution without slowing anything down.
</p>




<h3>
  RabbitMQ
</h3>




<p>
  RabbitMQ is a popular choice for message queue service, especially in Rails world. Honestly, I haven’t tried different implementations, because RabbitMQ really has everything I need.
</p>




<p>
  There are Ruby gems for communicating with RabbitMQ and it’s also easy to install and configure.
</p>




<p>
  <img src="/images/rabbitmq_concepts.png" width="400" alt="Use Message Queue in Rails" />
</p>




<p>
  In this diagram there are presented some concepts introduced by RabbitMQ. Publisher leaves messages in the exchange. Then they are routed from the exchange to multiple queues. There are many routing algorithms available – <a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchanges" target="_blank">https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchanges</a>
</p>




<p>
  Workers grab messages from queue. If there are multiple workers connected to one queue, they will be load balanced and the message will be delivered only to one of them.
</p>




<h3>
  Easy case
</h3>




<p>
  If you feel overwhelmed – don’t worry. Here is what you should start with:
</p>




<p>
  <img src="/images/rabbitmq_easy_case.png" width="400" alt="Use Message Queue in Rails" />
</p>




<h3>
  Publishing
</h3>




<p>
  Now it’s time for some code. It’s really simple, because integration with RabbitMQ is simple. We will use two gems – <code>bunny</code> and <code>sneakers</code>.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;bunny&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># an initializer</span>
</span><span class='line'><span class="n">connection</span> <span class="o">=</span> <span class="no">Bunny</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">host</span><span class="p">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">connection</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'><span class="n">channel</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">create_channel</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># a service</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RabbitPublisher</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="n">exchange_name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="n">exchange</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">fanout</span><span class="p">(</span><span class="n">exchange_name</span><span class="p">,</span> <span class="ss">durable</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span><span class='line'>    <span class="n">exchange</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">to_json</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:channel</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<h3>
  Receiving
</h3>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;sneakers&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># an initializer</span>
</span><span class='line'><span class="no">Sneakers</span><span class="o">.</span><span class="n">configure</span>  <span class="ss">daemonize</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>                    <span class="ss">amqp</span><span class="p">:</span> <span class="s2">&quot;amqp://localhost&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="ss">log</span><span class="p">:</span> <span class="s2">&quot;log/sneakers.log&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">pid_path</span><span class="p">:</span> <span class="s2">&quot;tmp/pids/sneakers.pid&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="ss">threads</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>                    <span class="ss">workers</span><span class="p">:</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># app/workers/events_worker.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">EventsWorker</span>
</span><span class='line'>  <span class="kp">include</span> <span class="ss">Sneakers</span><span class="p">:</span><span class="ss">:Worker</span>
</span><span class='line'>  <span class="n">from_queue</span> <span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="ss">env</span><span class="p">:</span> <span class="kp">nil</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">raw_event</span><span class="p">)</span>
</span><span class='line'>    <span class="n">event_params</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">raw_event</span><span class="p">)</span>
</span><span class='line'>    <span class="no">SomeWiseService</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">event_params</span><span class="p">)</span>
</span><span class='line'>    <span class="n">ack!</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  For details refer to documentation of <a href="https://github.com/ruby-amqp/bunny" target="_blank">bunny</a> and <a href="https://github.com/jondot/sneakers" target="_blank">sneakers</a>.
</p>




<p>
  If you enjoyed this article you can consider ping me for more details.
</p>




<p>
  So far so good, That&#8217;s it!!! See ya!!! :)
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/19/ajax-on-rails/">Ajax on Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-19T11:37:00+07:00" pubdate data-updated="true">Jun 19<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/ajax_on_rails.png" width="400" alt="Ajax on Rails" />
</p>




<p>
  This is a tutorial for ajax use with Rails conventions. For illustrative purposes, we’ll build a single-page Product list app.
</p>




<p>
  <strong>About Ajax</strong><br/>
  Ajax (Asynchronous JavaScript and XML) is used as a mechanism for sending and retrieving data asynchronously (in the background). While XML can certainly be used with ajax, it is not limited to this format. The JSON format, for example, is more commonly used today, especially in the Rails community. There are significant advantages in using Ajax, which include better user interactivity. Ajax allows content on a page to be updated without having to re-render the entire page, making it a &#8220;seamless&#8221; experience.
</p>




<p>
  <strong>Create a New Product on the Index Page</strong><br/>
  Before we start, let’s take a quick look at our schema so that we know what we’re working with:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Schema</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="ss">version</span><span class="p">:</span> <span class="mi">20140620130316</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">create_table</span> <span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="ss">force</span><span class="p">:</span> <span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="s2">&quot;created_at&quot;</span><span class="p">,</span>  <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span>  <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">string</span>   <span class="s2">&quot;name&quot;</span><span class="p">,</span>        <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">string</span>   <span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  After creating a Product model and then create some products to play with, our Product Controller should look like this:
</p>




<figure class='code'><figcaption><span>products_controller.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Instead of creating <code>new.html.erb</code>, let’s add a button somewhere on our <code>index.html.erb</code> that users can use to display a hidden form:
</p>




<figure class='code'><figcaption><span>index.html.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New Product&#39;</span><span class="p">,</span> <span class="n">new_product_path</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span> <span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Here we pass the <code>remote: true</code> option to disable the default Rails mechanism that would have otherwise navigated us to <code>/products/new</code>.
</p>




<p>
  Before moving on, let’s quickly revisit our Product Controller and set it up to create new products with ajax:
</p>




<figure class='code'><figcaption><span>products_controller.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:all_product</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:create</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># index action has been removed</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="vi">@product</span>  <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">product_params</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">all_products</span>
</span><span class='line'>    <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">product_params</span>
</span><span class='line'>    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:product</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:description</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  I have removed the index action because I created a <code>before_action</code> filter that creates the <code>@products</code> instance variable for us automatically. Because we no longer have any logic in our index action, it is not necessary. Rails will automatically render the correct template, even without the presence of the action.
</p>




<p>
  Noteworthy here is the <code>respond_to</code> method invoked near the top that will allow us to render both html and javascript responses with all of our controller actions. The respond_to method provides the ability to respond to the requests with many formats(i.e. csv, xml, etc…). This can be done for one or all actions in a controller. If we wanted to provide json only in our index action, we would write something like this:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>  <span class="vi">@products</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">format</span><span class="o">.</span><span class="n">html</span>
</span><span class='line'>    <span class="nb">format</span><span class="o">.</span><span class="n">json</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Now, choose a place on the index page to hide your form by passing a style attribute with the following:
</p>




<figure class='code'><figcaption><span>index.html.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;product-form&quot;</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;display:none;&quot;</span><span class="o">&gt;&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">...</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  which will hide our form when the page is initially visited.
</p>




<p>
  Next, create <code>new.js.erb</code>:
</p>




<figure class='code'><figcaption><span>new.js.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span><span class="p">(</span><span class="s1">&#39;#product-form&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= j (render &#39;form&#39;) %&gt;&quot;</span><span class="p">);</span>
</span><span class='line'><span class="err">$</span><span class="p">(</span><span class="s1">&#39;#product-form&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">slideDown</span><span class="p">(</span><span class="mi">350</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  This is just an ERB template that generates Javascript instead of the HTML we’re used to. It basically translates to: &#8220;Find the element with an id attribute of product-form and at that point render the html in the form partial.&#8221; We typically do this in <code>new.html.erb</code> with:
</p>




<figure class='code'><figcaption><span>new.html.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;form&#39;</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p><p>
  Since render is a Rails method, JavaScript doesn’t understand it and it has to be interpreted with ERB. The &lsquo;j&rsquo; is syntactic sugar for <code>&lt;%= escape_javascript (render &lsquo;form&rsquo;) %></code>
</p></p>

<p><figure class='code'><figcaption><span>_form.html.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= simple_form_for @product, remote: true do |f| %&gt;</span>
</span><span class='line'><span class="sx">  &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">input</span>  <span class="ss">:description</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">  &lt;%= f.input  :deadline %&gt;</span>
</span><span class='line'>  <span class="o">&lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">button</span> <span class="ss">:submit</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;% end %&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><p>
  This is the &lsquo;form&rsquo; being rendered in <code>new.js.erb</code> with a <code>remote: true</code> option being passed in. In our form partial, we also pass the <code>remote: true</code> option that will execute an ajax POST request.
</p></p>

<p><p>
  Finally, we can wrap things up by rendering our new Product list and hiding our form. This final step includes identifying where to render our list. Using the rai-jax app as an example, let’s look at what our final <code>index.html.erb</code> should look like at this stage:
</p></p>

<p><figure class='code'><figcaption><span>index.html.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-5 col-md-offset-1&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="no">Products</span><span class="o">&lt;</span><span class="sr">/h2&gt;</span>
</span><span class='line'><span class="sr">  &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-2 col-md-offset-4&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="sx">%= link_to new_product_path, remote: true do %&gt;</span>
</span><span class='line'><span class="sx">      &lt;button class=</span><span class="s2">&quot;btn btn-default&quot;</span><span class="o">&gt;</span><span class="no">New</span><span class="o">&lt;</span><span class="sr">/button&gt;</span>
</span><span class='line'><span class="sr">    &lt;% end %&gt;</span>
</span><span class='line'><span class="sr">  &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;div class=&quot;row&quot;&gt;</span>
</span><span class='line'><span class="sr">  &lt;div class=&quot;col-md-6 col-md-offset-2&quot; id=&quot;product-form&quot; style=&quot;display:none;&quot;&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;div class=&quot;row&quot;&gt;</span>
</span><span class='line'><span class="sr">  &lt;div class=&quot;col-md-7 col-md-offset-1&quot; id=&quot;products&quot;&gt;&lt;%= render @products %&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><p>
  And we update our product list and hide our form with <code>create.js.erb</code>:
</p></p>

<p><figure class='code'><figcaption><span>create.js.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span><span class="p">(</span><span class="s1">&#39;#products&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= j (render @products) %&gt;&quot;</span><span class="p">);</span>
</span><span class='line'><span class="err">$</span><span class="p">(</span><span class="s1">&#39;#product-form&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">slideUp</span><span class="p">(</span><span class="mi">350</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><p>
  <strong>Update a Product on the Index Page</strong><br/>
  As in Part One, let’s start by visiting our Product Controller and setting it up for updates:
</p></p>

<p><figure class='code'><figcaption><span>products_controller.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:all_products</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:set_products</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">update</span>
</span><span class='line'>    <span class="vi">@product</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">product_params</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">set_products</span>
</span><span class='line'>    <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">product_params</span>
</span><span class='line'>    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:product</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:description</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><p>
  Similar to Part One, we add an edit button with a <code>remote:</code> true option:
</p></p>

<p><figure class='code'><figcaption><span>_product.html.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">edit_product_path</span><span class="p">(</span><span class="n">product</span><span class="p">),</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span> <span class="k">do</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">    &lt;button&gt;</span><span class="no">Edit</span><span class="o">&lt;</span><span class="sr">/button&gt;</span>
</span><span class='line'><span class="sr">  &lt;% end %&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&hellip;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><p>
  And, finally, our <code>edit.js.erb</code> and <code>update.js.erb</code> are the same as our new and update templates: <code>edit.js.erb</code> corresponds to <code>new.js.erb</code> and <code>create.js.erb</code> corresponds to <code>update.js.erb</code>.
</p></p>

<p><p>
  <strong>Delete a Product on the Index Page</strong><br/>
  Our final updates to our Product Controller involves us providing the destroy action:
</p></p>

<p><figure class='code'><figcaption><span>product_controller.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:all_products</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:set_products</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>    <span class="vi">@product</span><span class="o">.</span><span class="n">destroy</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><p>
  When adding our delete button, two additional steps are required:
</p></p>

<p><figure class='code'><figcaption><span>_product.html.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="n">product</span><span class="p">,</span> <span class="ss">remote</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:delete</span><span class="p">,</span>  <span class="ss">data</span><span class="p">:</span> <span class="p">{</span> <span class="ss">confirm</span><span class="p">:</span> <span class="s1">&#39;Are you sure?&#39;</span> <span class="p">}</span> <span class="k">do</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">  &lt;button&gt;</span><span class="no">Delete</span><span class="o">!&lt;</span><span class="sr">/button&gt;</span>
</span><span class='line'><span class="sr">&lt;% end %&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&hellip;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><p>
  First, we pass in a <code>method: :delete</code> option; Second, we provide a courtesy confirmation to the user making sure they don’t delete anything by accident.
</p></p>

<p><p>
  The last file we’ll create is <code>destroy.js.erb</code> and it will contain one line:
</p></p>

<p><figure class='code'><figcaption><span>destroy.js.erb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span><span class="p">(</span><span class="s1">&#39;#products&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s2">&quot;&lt;%= j (render @products) %&gt;&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><p>
  Seriously, Rails makes ajax easy. As I mentioned above.
</p></p>

<p><p>
  So far so good, That&rsquo;s it!!! See ya!!! :)
</p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/18/the-10-best-project-management-tools-for-freelancers/">The 10 Best Project Management Tools for Freelancers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-18T00:16:00+07:00" pubdate data-updated="true">Jun 18<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  You just heard back from your Client No 1: He likes your pitch and wants a first draft within seven days. Client No 2 just sent you his comments on your piece and would like to see revisions by Friday. Client No 3 needs an invoice for the projects you’ve already completed this month. Meanwhile, you’re waiting on checks from Client Nos 4, 5, and 6. Oh, and you’re still putting together some ideas for Client No 7.
</p>




<p>
  Sound familiar?
</p>




<p>
  The nature of freelancing means you’re constantly juggling projects in different stages of completion. And you have to be keenly away of letting any accidentally drop because your reputation depends on meeting your deadlines, while your livelihood depends on making sure you get paid.
</p>




<p>
  Luckily, there are some great online tools out there that’ll allow you to carefully track the progress of every project on your docket. Check out my top 10.
</p>




<p>
  <h3><a href="https://asana.com/" target="_blank">Asana</a></h3><br/>
</p>




<p>
  <img src="/images/asana.png" />
</p>




<p>
  Not only does Asana’s clean, simple layout make it incredibly easy on the eyes, it also makes using and mastering this app a breeze. When you create a project, which can be broken down into sub-tasks with individual deadlines, it’s really easy to monitor exactly what you’ve done and what still needs to be taken care of.
</p>




<p>
  I suggest making every assignment a separate project and using Asana’s &#8220;Highlight&#8221; feature to color-code them based on the client. Then, you can outline everything that needs to happen from pitching to getting paid.
</p>




<p>
  Asana also allows you to upload attachments and share your projects with other people—meaning you can loop in your clients or collaborators depending on the situation.
</p>




<p>
  <h3><a href="https://trello.com/" target="_blank">Trello</a></h3><br/>
</p>




<p>
  <img src="/images/trello.png" />
</p>




<p>
  Trello is a good choice if you handle a lot of recurring projects for different clients or if you’re a very visual thinker. Its basic organizational tool is the &#8220;board&#8221;. Each board is separated into lists, and each list is composed of one or more “cards”, which represent separate tasks.
</p>




<p>
  I recommend making a different board for every client. Then, depending on how each client handles submission and payment, you can make individualized lists for each step of the process. Maybe your first list is &#8220;Pitched&#8221;, your next list is &#8220;Approved&#8221;, and so on until a list for &#8220;Paid.&#8221;
</p>




<p>
  Once you’ve made a card for each task you need to complete, you can give it a deadline, add an attachment, choose labels, make a checklist, write notes, and even share it with other Trello users.
</p>




<p>
  <h3><a href="https://www.wrike.com/" target="_blank">Wrike</a></h3><br/>
</p>




<p>
  <img src="/images/wrike.png" />
</p>




<p>
  At first, Wrike seems pretty similar to Asana and Trello: You set up folders, create tasks, and assign task deadlines. However, Wrike has a few unique features really set it apart.
</p>




<p>
  First, it automatically tracks how much time you spend on each task, which is really helpful if you charge by the hour or need to see how long a project is taking. Second, it lets you create and share your project schedule. Once you’ve planned out a project, all you have to do is click the “Share timeline” button, and Wrike will send snapshots of your schedule to anyone you want, even if they don’t have a Wrike account. And third, Wrike integrates with a bunch of third-party apps, like Chrome, your email, cloud storage, and iCal.
</p>




<p>
  <h3><a href="http://www.thrivesolo.com/" target="_blank">Solo</a></h3><br/>
</p>




<p>
  <img src="/images/solo.png" />
</p>




<p>
  Solo belongs on this list because it was specifically designed for freelancers. In addition to creating projects and setting due dates, you can also create a client roster, which analyzes how many returning clients you have, what sectors they’re in, and how profitable you are working with them. You can easily see which clients are your most valuable while also keeping track of basic contact info like phone numbers and emails.
</p>




<p>
  This is also cool: When you can make invoices in the app, the software tracks which clients have paid you, which clients have overdue payments, and which clients you still need to bill.
</p>




<p>
  Solo also comes with a &#8220;Quotes&#8221; feature that logs how many quotes you’ve sent out and tracks how many have been accepted.
</p>




<p>
  <h3><a href="https://www.wunderlist.com/" target="_blank">WunderList</a></h3><br/>
</p>




<p>
  <img src="/images/wunder_list.png" />
</p>




<p>
  This tool is definitely the way to go if you want a quick and easy way to keep all your assignments organized. You start out on Wunderlist by making folders—I give each client their own—then adding “to-dos.” The program offers reminders in addition to deadlines. The reminder feature is super helpful—for example, maybe you need to interview someone for a story in the next eight days, so you can easily add a reminder at the four-day mark.
</p>




<p>
  Plus, Wunderlist pulls to-dos from emails. Let’s say you get a message from a client asking for revisions; just forward it to Wunderlist, and “make revisions on X article” will become a task.
</p>




<p>
  <h3><a href="https://podio.com/site/en" target="_blank">Podio</a></h3><br/>
</p>




<p>
  <img src="/images/podio.png" />
</p>




<p>
  When it comes to personalization, most project management tools are fairly limited—you can adjust names and color-code, but that’s pretty much it. Not so with Podio, which lets you completely control the design of each project outline.
</p>




<p>
  You can add endless fields to each, from links or numbers to text boxes, categories, and even maps. So if your typical assignments are pretty detailed and complex (or you just want an app that gives you lots of customization power), Podio is worth checking out.
</p>




<p>
  You can also make project templates, which comes in handy if your freelance process can be replicated. Let’s say you write a similar set of articles every month for the same magazine; rather than creating a new project each time, you can use the template option to clone the first one and reuse it in the future.
</p>




<p>
  <h3><a href="https://redbooth.com/" target="_blank">RedBooth</a></h3><br/>
</p>




<p>
  <img src="/images/red_booth.png" />
</p>




<p>
  Thanks to its email and desktop notifications, Redbooth is ideal for people juggling a lot of deadlines. Suppose you’ve created a task like “Turn in website copy for approval” and set the deadline for August 14. If you haven’t marked the task as completed by that day, Redbooth will either ping you on your browser, send you an email, or both. In other words, you’ll never miss a deadline because of forgetfulness.
</p>




<p>
  There’s also a useful &#8220;Reporting&#8221; section. This tab will show you when you’re finishing tasks, from “early” to “more than 1 week,” and record all your activity from the past seven days.
</p>




<p>
  <h3><a href="https://www.getflow.com/" target="_blank">Flow</a></h3><br/>
</p>




<p>
  <img src="/images/flow.png" />
</p>




<p>
  Want a project management tool that’s functional without all the bells and whistles? Go with Flow. It has all the basic functionality of the others (separate workspaces for separate projects, project and task creation, work history, etc.), but without some of the busy interfaces. In fact, its design is nearly Mac-like in its minimalism and friendliness for new users.
</p>




<p>
  In addition to the computer-based platform, you can also use Flow’s iPhone and Android apps. Plus, the software also comes in a specific version for Macs so you don’t have to go through the brief hassle of opening Flow in your Internet browser.
</p>




<p>
  <h3><a href="https://quire.io/" target="_blank">Quire</a></h3><br/>
</p>




<p>
  <img src="/images/quire.png" />
</p>




<p>
  Quire’s setup is pretty traditional: You’ve got projects composed of tasks that can be drilled down into sub-tasks. Furthermore, you can set due dates, add tags, and track your progress.
</p>




<p>
  However, Quire has a few qualities stands out. It has a ton of keyboard shortcuts, which means after a week or two of using the platform, you’ll be navigating really quickly. Also, you can make individual projects viewable by URL—so if you have a client who wants to know exactly what the status is for an assignment, you can conveniently share the project specs. This feature can also be helpful if the project scope expands and you’d like to renegotiate your price.
</p>




<p>
  And if you like looking at physical to-do lists, rather than virtual ones, Quire automatically formats your tasks for printing.
</p>




<p>
  <h3><a href="http://taskboard.matthewross.me/" target="_blank">TaskBoard</a></h3><br/>
</p>




<p>
  <img src="/images/task_board.png" />
</p>




<p>
  Unlike the other tools above, Taskboard is a completely free, open-source project. You don’t make an account to access Taskboard; you just download it.
</p>




<p>
  My favorite Taskboard feature is the &#8220;automatic option.&#8221; When specific criteria are met, items will automatically update. For example, you can tell Taskboard to clear the deadline if you mark a task as complete before its deadline. The automation saves you from having to constantly fiddle with all the different details to keep your board clean.
</p>




<p>
  Taskboard’s Markdown compatibility makes it even simpler to use. (If you’ve never heard of Markdown, it’s a plain text style that converts to HTML and saves you tons of time formatting your work) Thanks to this feature, you can seamlessly transition your comments, notes, and reminders from documents to Taskboard to a website, and back again.
</p>




<p>
  So far go good, That&#8217;s it!!! See ya!!! :)
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/17/is-ruby-interpreted-or-compiled/">Is Ruby Interpreted or Compiled?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-17T12:14:00+07:00" pubdate data-updated="true">Jun 17<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/rights_and_wrongsof_ruby.jpg" width="400" />
</p>




<p>
  Ever since I started to work with Ruby in 2012, I’ve always assumed that it was an interpreted language like PHP or Javascript – in other words, that Ruby read in, parsed and executed my code all at runtime, at the moment my program was run. This seemed especially obvious since the default and most popular implementation of Ruby is called “MRI,” short for “Matz’s Ruby Interpreter.” I always thought it was necessary to use an interpreter to make all of the dynamic features of the language possible.
</p>




<p>
  However, it turns out that both JRuby and Rubinius, two other popular implementations of Ruby, support using a compiler the same way you would with a statically typed language like C or Java. Both JRuby and Rubinius first compile your Ruby code to byte code into machine language, and later execute it.
</p>




<p>
  Today I’m going to show you how to use these Ruby compilers, and I’ll also take a peek under the hood to see what they produce internally. Possibly you’ll rethink some of your assumptions about how Ruby works along the way.
</p>




<p>
  <strong>Use the Rubinius Compiler</strong><br/>
  Using the Rubinius compiler is as simple as running any Ruby script. Here’s a very silly but simple Ruby program I’ll use as an example today:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Adder</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_two</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>    <span class="n">x</span><span class="o">+</span><span class="mi">2</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="no">Adder</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">add_two</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Now if I save that into a file called “simple.rb,” switch to Rubinius using RVM, and run the script I’ll get the number “5” as expected:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rvm</span> <span class="n">rbx</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">-</span><span class="mi">20110705</span>
</span><span class='line'><span class="err">$</span> <span class="n">ruby</span> <span class="n">simple</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="mi">5</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Not very interesting, I know. But what is interesting is that when I ran simple.rb Rubinius created a new, hidden directory called “.rbx” with a strange, cryptically named file in it:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">a</span>
</span><span class='line'><span class="o">.</span>         <span class="o">.</span><span class="n">.</span>        <span class="o">.</span><span class="n">rbx</span>      <span class="n">simple</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="err">$</span> <span class="n">find</span> <span class="o">.</span><span class="n">rbx</span>
</span><span class='line'><span class="o">.</span><span class="n">rbx</span>
</span><span class='line'><span class="o">.</span><span class="n">rbx</span><span class="o">/</span><span class="n">a7</span>
</span><span class='line'><span class="o">.</span><span class="n">rbx</span><span class="o">/</span><span class="n">a7</span><span class="o">/</span><span class="n">a7fc1eb2edc84efed8db760d37bee43753483f41</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  This vaguely reminds me of how git saves the git repository data in a hidden folder called “.git,” also using cryptic hexadecimal names. What we are looking at here is a compiled version of simple.rb: the “a7fc1eb2e…” file contains my Ruby code converted into Rubinius byte code.
</p>




<p>
  Whenever you run a Ruby script, Rubinius uses a two step process to compile and run your code:
</p>




<p>
  <img src="/images/rubinius_diagram.png" />
</p>




<p>
  On the top you can see that first Rubinius compiles your code into byte code, and then below later executes it using the Rubinius Virtual Machine, which can compile the byte code into native machine language. Rubinius also caches the byte code using the hexadecimal naming scheme I showed above, avoiding the need for the compile step entirely if the Ruby source code file didn’t change.
</p>




<p>
  You can actually run the Rubinius compiler directly like this:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rbx</span> <span class="n">compile</span> <span class="n">simple</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">o</span> <span class="n">simple</span><span class="o">.</span><span class="n">bytecode</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  This compiles my Ruby code and saves the byte code in the specified file. If we look at the simple.bytecode file, we’ll see a series of alphanumeric tokens that don’t make any sense. But if you run the compiler using the “-B” option you can see an annotated version of the Rubinius byte code:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rbx</span> <span class="n">compile</span> <span class="n">simple</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">o</span> <span class="n">simple</span><span class="o">.</span><span class="n">bytecode</span> <span class="o">-</span><span class="n">B</span>
</span><span class='line'><span class="o">=============</span> <span class="ss">:__script__</span> <span class="o">==============</span>
</span><span class='line'><span class="ss">Arguments</span><span class="p">:</span>   <span class="mi">0</span> <span class="n">required</span><span class="p">,</span> <span class="mi">0</span> <span class="n">post</span><span class="p">,</span> <span class="mi">0</span> <span class="n">total</span>
</span><span class='line'><span class="ss">Arity</span><span class="p">:</span>       <span class="mi">0</span>
</span><span class='line'><span class="ss">Locals</span><span class="p">:</span>      <span class="mi">0</span>
</span><span class='line'><span class="no">Stack</span> <span class="ss">size</span><span class="p">:</span>  <span class="mi">6</span>
</span><span class='line'><span class="no">Lines</span> <span class="n">to</span> <span class="ss">IP</span><span class="p">:</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">26</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">27</span><span class="o">.</span><span class="n">.</span><span class="mi">63</span>
</span><span class='line'>
</span><span class='line'><span class="mo">0000</span><span class="p">:</span>  <span class="n">push_rubinius</span>
</span><span class='line'><span class="mo">0001</span><span class="p">:</span>  <span class="n">push_literal</span>               <span class="ss">:Adder</span>
</span><span class='line'><span class="mo">0003</span><span class="p">:</span>  <span class="n">push_nil</span>
</span><span class='line'><span class="mo">0004</span><span class="p">:</span>  <span class="n">push_scope</span>
</span><span class='line'><span class="mo">0005</span><span class="p">:</span>  <span class="n">send_stack</span>                 <span class="ss">:open_class</span><span class="p">,</span> <span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="n">etc</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="o">===============</span> <span class="ss">:add_two</span> <span class="o">===============</span>
</span><span class='line'><span class="ss">Arguments</span><span class="p">:</span>   <span class="mi">1</span> <span class="n">required</span><span class="p">,</span> <span class="mi">0</span> <span class="n">post</span><span class="p">,</span> <span class="mi">1</span> <span class="n">total</span>
</span><span class='line'><span class="ss">Arity</span><span class="p">:</span>       <span class="mi">1</span>
</span><span class='line'><span class="ss">Locals</span><span class="p">:</span>      <span class="mi">1</span><span class="p">:</span> <span class="n">x</span>
</span><span class='line'><span class="no">Stack</span> <span class="ss">size</span><span class="p">:</span>  <span class="mi">3</span>
</span><span class='line'><span class="no">Lines</span> <span class="n">to</span> <span class="ss">IP</span><span class="p">:</span> <span class="mi">2</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">5</span>
</span><span class='line'>
</span><span class='line'><span class="mo">0000</span><span class="p">:</span>  <span class="n">push_local</span>                 <span class="mi">0</span>    <span class="c1"># x</span>
</span><span class='line'><span class="mo">0002</span><span class="p">:</span>  <span class="n">meta_push_2</span>
</span><span class='line'><span class="mo">0003</span><span class="p">:</span>  <span class="n">meta_send_op_plus</span>          <span class="ss">:+</span>
</span><span class='line'><span class="mo">0005</span><span class="p">:</span>  <span class="n">ret</span>
</span><span class='line'>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="n">etc</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  At the bottom here we can see the compiled version of my silly add_two method. It’s actually somewhat easy to understand the byte code, since it’s annotated so well:
</p>




<p>
  - First “push_local” saves the value of the “x” parameter on the virtual machine stack.<br/>
  - Then it pushes the literal value 2.<br/>
  - Then it executes the + operation.<br/>
  - And finally it returns.
</p>




<p>
  The Rubinius virtual machine reminds me of those old “reverse polish” calculators from the 1980s, in which you would enter values on a stack in a similar way. The Rubinius source code is actually quite easy to understand since a large portion of it is actually written in Ruby, while the rest is written in well documented C++. The Rubinius compiler is no exception: it’s actually written in Ruby too! If you’re interested, you can see how the Rubinius compiler works without having to understand C++ at all. To get started take a look in the “lib/compiler” directory.
</p>




<p>
  The Rubinius virtual machine, which runs the Rubinius byte code, is implemented in C++ and leverages an open source project called LLVM. Like JRuby, it uses a “Just In Time” compiler to convert the byte code to machine language at runtime. This means that your Ruby code, for example the add_two method above, ends up being converted into native machine language and run directly by your computer’s hardware.
</p>




<p>
  <strong>Use the JRuby Compiler</strong><br/>
  Now let’s take a look at how JRuby compiles Ruby code; I’ll start by using RVM to switch over to JRuby, and then I’ll run the same simple.rb script:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rvm</span> <span class="n">jruby</span><span class="o">-</span><span class="n">head</span>
</span><span class='line'><span class="err">$</span> <span class="n">ruby</span> <span class="n">simple</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="mi">5</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  No surprise, we get the same result. At a high level, JRuby uses the same two step process to run your script – first it compiles the Ruby code into byte code, and then executes the byte code using the Java Virtual Machine (JVM).
</p>




<p>
  Here’s another diagram showing the two step process, this time for JRuby:
</p>




<p>
  <img src="/images/jruby_diagram.png" />
</p>




<p>
  Like with Rubinius, it’s possible to run the JRuby compiler directly using the &#8220;jrubyc&#8221; command… following the Java executable naming pattern (&#8220;java&#8221; –> &#8220;javac&#8221;). Running &#8220;jrubyc&#8221; will create a Java .class file, which we can inspect using the Java decompiler like I did last week:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">jrubyc</span> <span class="n">simple</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="err">$</span> <span class="n">ls</span>
</span><span class='line'><span class="n">simple</span><span class="o">.</span><span class="n">class</span> <span class="n">simple</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="err">$</span> <span class="n">javap</span> <span class="o">-</span><span class="n">c</span> <span class="n">simple</span><span class="o">.</span><span class="n">class</span> <span class="o">&gt;</span> <span class="n">simple</span><span class="o">.</span><span class="n">bytecode</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Now the simple.bytecode file will contain an annotated version of the Java byte code the JVM will execute. Unlike Rubinius, which creates byte code that is fairly clean, simple and easy to understand, Java byte code is much more cryptic and confusing. Searching through the simple.bytecode file for my method add_two, I found the following snippet of byte code:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="kp">public</span> <span class="n">static</span> <span class="n">org</span><span class="o">.</span><span class="n">jruby</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">builtin</span><span class="o">.</span><span class="n">IRubyObject</span> <span class="n">method__1</span><span class="vg">$RUBY$add_two</span><span class="p">(</span><span class="n">simple</span><span class="p">,</span> <span class="n">org</span><span class="o">.</span><span class="n">jruby</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">Code</span><span class="p">:</span>
</span><span class='line'>       <span class="mi">0</span><span class="p">:</span> <span class="n">aload_3</span>
</span><span class='line'>       <span class="mi">1</span><span class="p">:</span> <span class="n">astore</span>        <span class="mi">9</span>
</span><span class='line'>       <span class="mi">3</span><span class="p">:</span> <span class="n">aload_1</span>
</span><span class='line'>       <span class="mi">4</span><span class="p">:</span> <span class="n">aload_2</span>
</span><span class='line'>       <span class="mi">5</span><span class="p">:</span> <span class="n">aload</span>         <span class="mi">9</span>
</span><span class='line'>       <span class="mi">7</span><span class="p">:</span> <span class="n">invokedynamic</span> <span class="c1">#80,  0             // InvokeDynamic #1:&quot;fixnumOperator:+&quot;:(Lorg/jruby/runtime/Thread...</span>
</span><span class='line'>      <span class="mi">12</span><span class="p">:</span> <span class="n">areturn</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Although quite difficult to understand, there are a couple of important details to notice:
</p>




<p>
  First, JRuby has compiled my Ruby add_two method into a byte code method called method__1$RUBY$add_two. This proves that my Ruby script has been compiled! That is, when JRuby ran simple.rb above, it did not read the Ruby code, interpret it and just follow the instructions like the MRI interpreter would do. Instead, it converted my Ruby script into byte code, and specifically my add_two method into the byte code snippet above.
</p>




<p>
  Second, notice the use of the “invokedynamic” byte code instruction. This is a new innovation of the Java Virtual Machine, making it easier for the JVM to support dynamic languages like Ruby. Here you can see it’s used by the add_two method to call the + operator of the Ruby Fixnum class, for my x+2 Ruby code. This use of invokedynamic is actually new for Java 1.7 and JRuby 1.7, so if you’re using the current release version of JRuby (1.6.4) or earlier you won’t see it appear in the byte code.
</p>




<p>
  All of the byte code you see above – in other words my Ruby script including the add_two method – will be compiled directly into native machine language if the JVM notices that it is called enough times, that it’s in a &#8220;hotspot&#8221;.
</p>




<p>
  <strong>Who cares how Ruby works?</strong><br/>
  Today I’ve shown you some of the internal, technical details of Rubinius and JRuby. Many of you might find this boring and unimportant: who cares how Ruby works internally? All I care about is that my Ruby program works. And from one point of view that is all that really matters.
</p>




<p>
  However, I find Ruby internals to be fascinating… I really do like having at least a small understanding of what’s going on inside of Ruby while it’s running my code. I also believe it will help me to become a more effective and knowledgeable Ruby developer, even if I never contribute a line of internal code to Rubinius, JRuby or MRI. And studying Ruby internals has definitely lead me to a number of surprising discoveries, and forced me to rethink the mental model I have always had of the Ruby interpreter… or should I say, the Ruby compiler!
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/16/how-the-hash-works-in-ruby/">How the Hash Works in Ruby?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-16T23:43:00+07:00" pubdate data-updated="true">Jun 16<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/happy_ruby_on_rails.jpg" width="400" alt="How the Hash Works in Ruby?" />
</p>




<p>
  A brief overview of the hash data structure, how it is implemented in Ruby and a peek at the history of changes made to the hash in MRI Ruby.
</p>




<p>
  <strong>What is a Hash?</strong><br/>
  A Hash is a data structure that organizes data in key-value pairs. It is also referred to as a dictionary or associative array. It stores these key-value pairs of associated data in a way that enables efficient insertion and lookup, in constant O(1) time. These properties of a hash make it is one of the most useful tools in a programmer’s toolbox and it is available in the core libraries of most if not all, programming languages.
</p>




<p>
  In Ruby a hash can be declared literally as:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="ss">color</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="ss">font</span><span class="p">:</span> <span class="s2">&quot;Monaco&quot;</span><span class="p">}</span>
</span><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:color</span><span class="o">=&gt;</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="ss">:font</span><span class="o">=&gt;</span><span class="s2">&quot;Monaco&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Or declaratively with the new method:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">h</span><span class="o">[</span><span class="ss">:color</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
</span><span class='line'><span class="n">h</span><span class="o">[</span><span class="ss">:font</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;Monoco&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>How does a Hash store data and why is it efficient?</strong><br/>
  o understand how data is stored in a hash and why it is efficient, let’s revisit the basic linear data structure, the array. An array allows us to randomly access any element that it stores if we know the index of that element beforehand.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o">]</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">a</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>  <span class="c1"># =&gt; 4</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  If the key-value pairs we were trying to store were integers within a limited range such as 1-20 or 1-100, we would simply use an array and our key would be the integer.
</p>




<p>
  For example, given that:<br/>
  - we need to store the names of the students in a classroom with 20 students<br/>
  - each student has a student id between 1 and 20<br/>
  - no two students have the same student id.
</p>




<p>
  We could simply store their names represented by the table below in an array:
</p>


<table>
<thead>
<tr>
<th>Key </th>
<th> Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 </td>
<td> Bunlong</td>
</tr>
<tr>
<td>2 </td>
<td> Jinglong</td>
</tr>
<tr>
<td>3 </td>
<td> Mickey Mouse</td>
</tr>
</tbody>
</table>


<br/>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">students</span><span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Belle&#39;</span><span class="p">,</span> <span class="s1">&#39;Ariel&#39;</span><span class="p">,</span> <span class="s1">&#39;Peter Pan&#39;</span><span class="p">,</span> <span class="s1">&#39;Mickey Mouse&#39;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  But, what if the student id was a 4-digit number? Then we would have to assign a 10000 element table to access the names by the id. To solve this we simplify the key to the last 2 digits of the 4 digit number and use that as the location inside the table, so we can get random access to the record. Now, if we have another student with id “3221”, also ending in “21”, we would have to save two values at that location resulting in a collision.
</p>


<table>
<thead>
<tr>
<th>Key </th>
<th> Hash(key) = last 2 digits </th>
<th> Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>4221, 3221</td>
<td> 21 </td>
<td> Bunlong</td>
</tr>
<tr>
<td>1357 </td>
<td> 57 </td>
<td> Jinglong</td>
</tr>
<tr>
<td>4612 </td>
<td> 12 </td>
<td> Mickey Mouse </td>
</tr>
</tbody>
</table>


<br/>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">students</span><span class="o">=</span> <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span><span class='line'><span class="n">students</span><span class="o">[</span><span class="mi">21</span><span class="o">]=[</span><span class="s1">&#39;Belle&#39;</span><span class="p">,</span><span class="s1">&#39;Sofia&#39;</span><span class="o">]</span>
</span><span class='line'><span class="n">students</span><span class="o">[</span><span class="mi">57</span><span class="o">]=</span><span class="s1">&#39;Ariel&#39;</span>
</span><span class='line'><span class="n">students</span><span class="o">[</span><span class="mi">12</span><span class="o">]=</span><span class="s1">&#39;Peter Pan&#39;</span>
</span><span class='line'><span class="n">students</span><span class="o">[</span><span class="mi">14</span><span class="o">]=</span><span class="s1">&#39;Mickey Mouse&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  What if the id was a 10-digit number or an alphanumeric string? This gets inefficient and unwieldy quickly. Unfortunately, too simple a hashing strategy can lead to problems.
</p>




<p>
  <strong>How Ruby’s hash function works?</strong><br/>
  So, now we have an understanding that the purpose of a hash function is to convert a given a key into an integer of limited range. In order to reduce the range, a commonly used technique is the division method. In the division method, the key is divided by the size of the storage or table and the remainder is the location inside that table where a record can be stored. Therefore, in the example above, if the table size was 20, the locations would be 1, 17, 12, 14 derived from the computation below.
</p>




<p>
  <code>4221 % 20 = 1</code><br/>
  <code>1357 % 20 = 17</code><br/>
  <code>4612 % 20 = 12</code><br/>
  <code>1514 % 20 = 14</code><br/>
</p>




<p>
  But in real life programming the keys are not always nice integers, they are strings, objects, or some other data type. This is solved by using a one-way hash function(digest) over the key and then applying the division method to get the location. The hash function is a mathematical function that takes a string of any length and produces a fixed length integer value. The hash data structure derives it’s name from this hashing mechanism. Ruby uses the <a href="https://en.wikipedia.org/wiki/MurmurHash" target="_blank">murmur hash function</a> and then applies the division method with a prime number M, which Ruby determines based on the table size that is needed for storage.
</p>




<p>
  <code>murmur_hash(key) % M</code>
</p>




<p>
  The code for this can be found in Ruby language’s source code in <a href="https://github.com/ruby/ruby/blob/1b5acebef2d447a3dbed6cf5e146fda74b81f10d/st.c" target="_blank">st.c file</a>.
</p>




<p>
  In case two keys return the same number, also known as a hash collision, the value is chained on to the same location or bucket in the table.
</p>




<p>
  <strong>How Ruby handles hash collisons and growth?</strong><br/>
  One of the problems faced by hash functions is distribution. What if most remainders fall into the same bucket? We would have to first find the bucket in the table from computing over the key, and then look through all the chained data in the location to find the matching record. That would defeat the purpose of creating a hash data structure for random access and O(1) time, because now we have to iterate over all these values to find the record which puts us back to O(n) time.
</p>




<p>
  It has been found that if divisor M is prime, the results are not as biased and more evenly distributed. But, even with the best divisor, collisions will occur as the number of records being added increases. Ruby adjusts the value of M based the density. Density is the number of records chained at a location in the table. In the above example, the density is 2, since we have 2 records that have the index/location 1.
</p>




<p>
  Ruby sets the maximum allowed density value to 5.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#define ST_DEFAULT_MAX_DENSITY 5</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  When the density of the records reaches 5, then Ruby adjusts the value of M, re-computes and adjust the hash for all the records that are in that hash. “The algorithm that computes M is one that generates prime numbers near powers of 2”, from <a href="http://www.amazon.com/Data-Structures-Using-Aaron-Tenenbaum/dp/0131997467" target="_blank">Data Structures using C</a>. Look at the function new_size in <a href="https://github.com/ruby/ruby/blob/1b5acebef2d447a3dbed6cf5e146fda74b81f10d/st.c" target="_blank">st.c</a> at line 158. This is where the size of the new hash is computed.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">new_size</span><span class="p">(</span><span class="n">st_index_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">st_index_t</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">31</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">((</span><span class="n">st_index_t</span><span class="p">)(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  This is easier to read in the <a href="https://github.com/jruby/jruby/blob/master/core/src/main/java/org/jruby/RubyHash.java" target="_blank">JRuby’s</a> implementation of Hash where the prepared prime number values are statically used from an int array. As you can see the next values are 11, 19 and so on.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">private</span> <span class="n">static</span> <span class="n">final</span> <span class="n">int</span> <span class="no">MRI_PRIMES</span><span class="o">[]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'><span class="mi">8</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">32</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">64</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">256</span> <span class="o">+</span> <span class="mi">27</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  This rehashing as the data grows larger causes a spike in the performance when the hash reaches certain specific sizes.
</p>




<p>
  <strong>Ruby hashes are unique for each process</strong><br/>
  One interesting thing to note is hashes are unique for each Ruby process. The murmur hash seeds it with a random value, which results in a different hash for a particular key for each Ruby process.
</p>




<p>
  <strong>Ruby has packed hashes for up to 6 entries since Ruby 2.0</strong><br/>
  Another interesting thing to note is that Ruby hashes that are very small(less than or equal to 6) are saved in one bucket and not spread over several buckets based on computed hash of the key. Instead, they are simply an array of values. This was added recently and is referred to as a packed entry in the code in st.c. On the <a href="https://github.com/ruby/ruby/pull/84" target="_blank">pull request</a> in which this change was submitted, the commiter has made the following comment.
</p>




<p>
  “Investigation shows, that typical rails application allocates tons of small hashes. Up to 40% of whole allocated hashes never grows bigger than 1 element size.”
</p>




<p>
  <strong>Ruby hash keys are ordered</strong><br/>
  Starting with Ruby 1.9.3, a property of the hash is that the keys are ordered based on how they are inserted into the hash. An interesting question was posted on the <a href="https://www.ruby-forum.com/topic/166075" target="_blank">Ruby-forum</a> questioning the reasoning behind it and how it would effect performance. The reply by Matz, creator of Ruby, on that thread, which explains the change is below.
</p>




<p>
  Could anybody explain why this feature was added?
</p>




<p>
  &#8220;Useful for some cases, especially for keyword arguments.&#8221;
</p>




<p>
  Isn’t it going to slow down the operations on the Hash?
</p>




<p>
  &#8220;No. hash reference operation does not touch order information, only for iteration. Memory consumption increased a bit.&#8221;
</p>




<p>
  Note: Keyword arguments were added to Ruby in 2.0, and an example is below:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">books</span><span class="p">(</span><span class="ss">title</span><span class="p">:</span> <span class="s1">&#39;Programming Ruby&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">title</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">books</span> <span class="c1"># =&gt; &#39;Programming Ruby&#39;</span>
</span><span class='line'><span class="n">books</span><span class="p">(</span><span class="ss">title</span><span class="p">:</span> <span class="s1">&#39;Eloquent Ruby&#39;</span><span class="p">)</span> <span class="c1"># =&gt; &#39;Eloquent Ruby&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Two potential upcoming changes in Hash</strong><br/>
  1- The next version of Ruby, will most likely introduce syntax sugar for a literal declaration of the hash that will allow spaces in symbols. Take a look at this commit on <a href="https://bugs.ruby-lang.org/issues/4276" target="_blank">ruby-trunk</a>. You may recall, that the first change from hashrocket to colon was introduced in Ruby 1.9 bringing the syntax closer to JSON’s syntax. With this upcoming change the hash will looks even more so like <a href="https://en.wikipedia.org/wiki/JSON" target="_blank">JSON</a>.
</p>




<p>
  Currently we need to declare a symbol with a space using a hash rocket:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:&quot;a perfect color&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;vermilion&quot;</span><span class="p">}</span> <span class="c1">#=&gt; {:&quot;a perfect color&quot;=&gt;&quot;vermilion&quot;}</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  With the change it will simply be the symbol within quotes followed by a colon:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a perfect color&quot;</span><span class="p">:</span> <span class="s2">&quot;vermilion&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  2- Another interesting change that is in the works is a method that will allow returning <a href="https://bugs.ruby-lang.org/issues/10017" target="_blank">default values for missing keys in a hash</a>.
</p>




<p>
  Currently you can return the default value of only one key using <code>hash.fetch</code>, however the <code>hash.values_at</code> method allows returning multiple values for keys:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="ss">color</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="ss">font</span><span class="p">:</span> <span class="s2">&quot;monaco&quot;</span><span class="p">}</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:fontsize</span><span class="p">,</span> <span class="s2">&quot;12pt&quot;</span><span class="p">)</span> <span class="c1">#=&gt; &quot;12pt&quot;</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">values_at</span><span class="p">(</span><span class="ss">:color</span><span class="p">,</span> <span class="ss">:font</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;black&quot;, &quot;monaco&quot;]</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The change proposed is to combine these two methods into one. It might work something like the <code>fetch_values</code> method shown below. Please note the new method name is still being voted on and the example is hypothetical.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch_values</span><span class="p">(</span><span class="ss">:color</span><span class="p">,</span> <span class="ss">:font</span><span class="p">,</span> <span class="ss">:fontsize</span><span class="p">,</span> <span class="ss">:border</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="o">|</span>
</span><span class='line'><span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;fontsize&quot;</span> <span class="p">?</span> <span class="s2">&quot;12pt&quot;</span> <span class="p">:</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">k</span><span class="si">}</span><span class="s2"> is missing&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1">#=&gt; [&quot;black&quot;, &quot;monaco&quot;, &quot;12pt&quot;, &quot;border is missing&quot;]</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  So far so good, That&#8217;s it!!! See ya!!! :)
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/08/master-ruby-blocks/">Master Ruby Blocks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-08T20:29:00+07:00" pubdate data-updated="true">Jun 8<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/happy_ruby_on_rails.jpg" width="400" alt="Master Ruby Blocks" />
</p>




<p>
  Blocks are one of the most powerful and often overlooked feature of ruby. I must confess that it took me a while to figure out how ruby blocks work and how they can be useful in practice.
</p>




<p>
  There is something about <code>yield</code> that makes blocks very hard to understand at first. I&#8217;m going to talk about some of the concepts and provide a few examples so by the end of this post you&#8217;ll have a solid understanding of ruby blocks.
</p>




<p>
  <strong>The basics: What are ruby blocks?</strong><br/>
  1. What are ruby blocks?<br/>
  2. How yield works?<br/>
  3. What does <code>&block</code> mean?<br/>
  4. Return value<br/>
  5. How does <code>.map(&:something)</code> work?<br/>
  6. Iterators and how to build one yourself<br/>
  7. Initialize objects with default values using blocks<br/>
  8. Ruby block examples
</p>




<p>
  <strong>What are ruby blocks?</strong><br/>
  A block is basically just code that you put inside <code>do</code> and <code>end</code>. That&#8217;s it. &#8220;But where&#8217;s the magic?&#8221; you might ask. We&#8217;ll get there in just a minute but first things first.
</p>




<p>
  You can write the block in two ways:<br/>
  1. Multi-line, between <code>do</code> and <code>end</code><br/>
  2. Inline, between <code>{</code> and <code>}</code>
</p>




<p>
  Both versions will do the exact same thing so it&#8217;s up to you which one you choose. As a general style-guide, it&#8217;s better to use the multi-line version if your code has more than one line, just to make it easier to read.
</p>




<p>
  Here&#8217;s a basic example of a multi-line block:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">n</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Number </span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  It&#8217;s called a multi-line block because it&#8217;s not inline, not because it&#8217;s got more than one line of code (which is not the case here). The same example can be written with an inline block:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;Number </span><span class="si">#{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Both versions will print numbers 1, 2 and 3 in order. The little n letter you see between the pipes (<code>|n|</code>) is called a block parameter and it&#8217;s value in this case is going to be each of the numbers in turn, in the order they are listed inside the array. So for the first iteration, the value of n will be 1, then for the second iteration, the value will be 2, and then 3.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Number</span> <span class="mi">1</span>
</span><span class='line'><span class="no">Number</span> <span class="mi">2</span>
</span><span class='line'><span class="no">Number</span> <span class="mi">3</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="kp">nil</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>How yield works?</strong><br/>
  Here&#8217;s the bad wolf. This guy is responsible for all the confusion and magic around ruby blocks. I think most of the confusion comes from the way it calls the block and how it&#8217;s passing parameters to it. We&#8217;ll be looking at both scenarios in this section.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">my_method</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;reached the top&quot;</span>
</span><span class='line'>  <span class="k">yield</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;reached the bottom&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">my_method</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;reached yield&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">reached</span> <span class="n">the</span> <span class="n">top</span>
</span><span class='line'><span class="n">reached</span> <span class="k">yield</span>
</span><span class='line'><span class="n">reached</span> <span class="n">the</span> <span class="n">bottom</span>
</span><span class='line'> <span class="o">=&gt;</span> <span class="kp">nil</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  So basically when the execution of <code>my_method</code> reaches the line with the call to <code>yield</code>, the code inside the block gets executed. Then, when the code inside the block finishes, the execution of <code>my_method</code> continues.
</p>




<p>
  <img src="/images/ruby_block_flow.png" alt="Ruby Block Flow" />
</p>




<p>
  <strong>Passing blocks to methods</strong><br/>
  A method doesn&#8217;t need to specify the block in it&#8217;s signature in order to receive a block parameter. You can just pass a block to any function but unless that function calls <code>yield</code>, the block won&#8217;t get executed.
</p>




<p>
  On the other hand, if you do call <code>yield</code> in your method, then the block parameter becomes mandatory and the method will raise an exception if it doesn&#8217;t receive a block.
</p>




<p>
  If you want to make the block an optional parameter, you can use the <code>block_given?</code> method which will return either true or false depending on if a block was passed in to the method or not.
</p>




<p>
  <strong>Yield takes parameters too</strong><br/>
  Any parameter passed to <code>yield</code> will serve as a parameter to the block. So when the block runs, it can use the parameters passed in from the original method. Those parameters can be variables local to the method in which <code>yield</code> lives in.
</p>




<p>
  The order of the arguments is important because the order you use to pass in the parameters is the order in which the block receives them.
</p>




<p>
  <img src="/images/ruby_block_arguments.png" alt="Ruby Block Arguments" />
</p>




<p>
  One thing to note here is that the parameters inside the block are local to the block (unlike those passed in from the method to the block).
</p>




<p>
  <strong>What does &block (ampersand parameter) mean?</strong><br/>
  You&#8217;ve probably seen this <code>&block</code> all over the place in ruby code. It&#8217;s how you can pass a reference to the block (instead of a local variable) to a method. In fact, ruby allows you to pass any object to a method as if it were a block. The method will try to use the passed in object if it&#8217;s already a block but if it&#8217;s not a block it will call to_proc on it in an attempt to convert it to a block.
</p>




<p>
  Also note that the <code>block</code> part (without the ampersand) is just a name for the reference, you can use whatever name you like if it makes more sense to you.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">block</span>
</span><span class='line'>  <span class="n">block</span><span class="o">.</span><span class="n">call</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">my_method</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">&quot;Hello!&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#&lt;Proc:0x0000010124e5a8@tmp/example.rb:6&gt;</span>
</span><span class='line'><span class="no">Hello</span><span class="o">!</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Return value</strong><br/>
  <code>yield</code> returns the last evaluated expression (from inside the block). So in other words, the value that <code>yield</code> returns is the value the block returns.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">my_method</span>
</span><span class='line'>  <span class="n">value</span> <span class="o">=</span> <span class="k">yield</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;value is: </span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">my_method</span> <span class="k">do</span>
</span><span class='line'>  <span class="mi">2</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">value</span> <span class="n">is</span> <span class="mi">2</span>
</span><span class='line'>  <span class="o">=&gt;</span> <span class="kp">nil</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>How does .map(&:something) work?</strong><br/>
  You&#8217;ve probably used shortcuts like <code>.map(&:capitalize)</code> a lot, especially if you&#8217;ve done any Rails coding. It&#8217;s a very clean shortcut to <code>.map { |title| title.capitalize }</code>.
</p>




<p>
  But how does it really work?
</p>




<p>
  It turns out that the Symbol class implements the to_proc method which will unwrap the short version into it&#8217;s longer variant. Nice right?
</p>




<p>
  <strong>Iterators and how to build one yourself</strong><br/>
  You can call yield as many times as you want inside a method. That&#8217;s basically how iterators work. Calling <code>yield</code> for each of the elements in the array mimics the behavior of the built in ruby iterators.
</p>




<p>
  Let&#8217;s see how we can write a method similar to the map method in ruby.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">my_map</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span class='line'>  <span class="n">new_array</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="n">element</span> <span class="k">in</span> <span class="n">array</span>
</span><span class='line'>    <span class="n">new_array</span><span class="o">.</span><span class="n">push</span> <span class="k">yield</span> <span class="n">element</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">new_array</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">my_map</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">number</span><span class="o">|</span>
</span><span class='line'>  <span class="n">number</span> <span class="o">*</span> <span class="mi">2</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">2</span>
</span><span class='line'><span class="mi">4</span>
</span><span class='line'><span class="mi">6</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Initialize objects with default values</strong><br/>
  A cool pattern we can use with ruby blocks is to initialize an object with default values. You&#8217;ve probably seen this pattern if you&#8217;ve ever ventured into a .gemspec file from any ruby gem.
</p>




<p>
  The way it works is, you have an initializer that calls <code>yield(self)</code>. In the context of the <code>initialize</code> method, <code>self</code> is the object being initialized.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Car</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:color</span><span class="p">,</span> <span class="ss">:doors</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="k">yield</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">car</span> <span class="o">=</span> <span class="no">Car</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
</span><span class='line'>  <span class="n">c</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;Red&quot;</span>
</span><span class='line'>  <span class="n">c</span><span class="o">.</span><span class="n">doors</span> <span class="o">=</span> <span class="mi">4</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;My car&#39;s color is </span><span class="si">#{</span><span class="n">car</span><span class="o">.</span><span class="n">color</span><span class="si">}</span><span class="s2"> and it&#39;s got </span><span class="si">#{</span><span class="n">car</span><span class="o">.</span><span class="n">doors</span><span class="si">}</span><span class="s2"> doors.&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">My</span> <span class="n">car</span><span class="s1">&#39;s color is Red and it&#39;</span><span class="n">s</span> <span class="n">got</span> <span class="mi">4</span> <span class="n">doors</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Ruby blocks examples</strong><br/>
  Examples are all the rage these days so let&#8217;s try to find a few interesting ways of using blocks in real world (or as close to real world as possible) scenarios.
</p>




<p>
  <strong>Wrap text in html tags</strong><br/>
  Blocks are the perfect candidate whenever you need to wrap a chunk of dynamic code within some static code. So for example if you want to generate an html tag for some text. The text is the dynamic part (cause you never know what you&#8217;ll want to wrap) and the tags are the static part, they never change.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">wrap_in_h1</span>
</span><span class='line'>  <span class="s2">&quot;&lt;h1&gt;</span><span class="si">#{</span><span class="k">yield</span><span class="si">}</span><span class="s2">&lt;/h1&gt;&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">wrap_in_h1</span> <span class="p">{</span> <span class="s2">&quot;Here&#39;s my heading&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># =&gt; &quot;&lt;h1&gt;Here&#39;s my heading&lt;/h1&gt;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">wrap_in_h1</span> <span class="p">{</span> <span class="s2">&quot;Ha&quot;</span> <span class="o">*</span> <span class="mi">3</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># =&gt; &quot;&lt;h1&gt;HaHaHa&lt;/h1&gt;&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Note that the power of using blocks over methods is when you need to reuse some of the behavior but do something slightly different with it. So let&#8217;s say we have a string we want to wrap inside html tags and then do something different with it.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">wrap_in_tags</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span class='line'>  <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;</span><span class="si">#{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&gt;</span><span class="si">#{</span><span class="n">text</span><span class="si">}</span><span class="s2">&lt;/</span><span class="si">#{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span class='line'>  <span class="k">yield</span> <span class="n">html</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">wrap_in_tags</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">html</span><span class="o">|</span> <span class="no">Mailer</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">html</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="n">wrap_in_tags</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">html</span><span class="o">|</span> <span class="no">Page</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="ss">:body</span> <span class="o">=&gt;</span> <span class="n">html</span><span class="p">)</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  In the first case we&#8217;re sending the <title>Hello</title> string via email and in the second case we&#8217;re creating a Page record. Both cases use the same method but they do different things.
</p>




<p>
  <strong>Take a note</strong><br/>
  Let&#8217;s say we want to build a way to quickly store ideas into a database table. For that to work we want to pass in the note and have the method deal with the database connections. Ideally we&#8217;d like to call <code>Note.create { "Nice day today" }</code> and not worry about opening and closing database connections. So let&#8217;s do this.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Note</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:note</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">note</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@note</span> <span class="o">=</span> <span class="n">note</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;@note is </span><span class="si">#{</span><span class="vi">@note</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">connect</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="kp">new</span><span class="p">(</span><span class="k">yield</span><span class="p">)</span>
</span><span class='line'>    <span class="n">note</span><span class="o">.</span><span class="n">write</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">disconnect</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">write</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;Writing </span><span class="se">\&quot;</span><span class="si">#{</span><span class="vi">@note</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> to the database.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">connect</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;Connecting to the database...&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">disconnect</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;Disconnecting from the database...&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Note</span><span class="o">.</span><span class="n">create</span> <span class="p">{</span> <span class="s2">&quot;Foo&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Connecting</span> <span class="n">to</span> <span class="n">the</span> <span class="n">database</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="vi">@note</span> <span class="n">is</span> <span class="no">Foo</span>
</span><span class='line'><span class="no">Writing</span> <span class="s2">&quot;Foo&quot;</span> <span class="n">to</span> <span class="n">the</span> <span class="n">database</span><span class="o">.</span>
</span><span class='line'><span class="no">Disconnecting</span> <span class="n">from</span> <span class="n">the</span> <span class="n">database</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  The implementation details of connecting, writing and disconnecting to and from the database were left out since they&#8217;re out of the scope of this article.
</p>




<p>
  <strong>Find divisible elements of an array</strong><br/>
  It seems like I&#8217;m getting further and further away from &#8220;the real world scenario&#8221; but anyways, I&#8217;m gonna shoot one last example. So let&#8217;s say you want to get every element of an array that is divisible by 3 (or any number you choose), how would you do that with ruby blocks?
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Fixnum</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">to_proc</span>
</span><span class='line'>    <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="o">|</span>
</span><span class='line'>      <span class="n">obj</span> <span class="o">%</span> <span class="nb">self</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">numbers</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="o">].</span><span class="n">select</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">numbers</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">3</span>
</span><span class='line'><span class="mi">6</span>
</span><span class='line'><span class="mi">9</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  You can think of blocks as simply a chunk of code, and yield allows you to inject that code at some place into a method. That means you can have one method work in different ways, you don&#8217;t have to write multiple methods (you can reuse one method to do different things).
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/06/how-to-use-link-to-in-ruby-on-rails/">How to Use Link_to in Ruby on Rails?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-06T21:39:00+07:00" pubdate data-updated="true">Jun 6<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
  <img src="/images/happy_ruby_on_rails.jpg" width="400" alt="How to Use link_to in Ruby on Rails?" />
</p>




<p>
  Even after many years of using Ruby on Rails I still have trouble remembering how to properly use all those options available for the link_to helper. Three out of five times I have to fire up the docs and search for the examples (cause that&#8217;s how I like to read the docs).
</p>




<p>
  <strong>Having Documentation in Hand</strong><br/>
  Using documentation locally is helpful, especially if you can integrate it into your editor. Personally I&#8217;m using the <code>ri</code> docs with Vim but I guess all those other editors can be configured to access it. If not you can always use ri in your terminal of choice.
</p>




<p>
  Another favourite of mine is the awesome ApiDock. You can even see other people&#8217;s comments on the docs and in many cases there you can find examples that are not present in the official docs.
</p>




<p>
  Another very good option (if you&#8217;re on a mac) is to use Dash. It&#8217;s easy to integrate in your editor or you can just fire it up with a system shortcut whenever you need to access the docs.
</p>




<p>
  That being said, I&#8217;m gonna list out a few of the more common examples I use in hopes that they will be useful for both you and me whenever I need to revisit <code>link_to</code>&#8217;s docs again.
</p>




<p>
  <strong>The Simplest Form</strong><br/>
  The most common and straightforward way of using <code>link_to</code> is to create a barebones (no magic) link. So, assuming your root route points to &#8216;/&#8217;, the way you would use the helper is:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Home&quot;, root_path %&gt;</span>
</span><span class='line'><span class="sx"># =</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="no">Home</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Link-ing to a Resource</strong><br/>
  Another common variant is linking to a resource (a user&#8217;s profile for example). Let&#8217;s say the user&#8217;s model is called User and that a @user ivar points to the user record who&#8217;s id is 1. Creating a link to the user&#8217;s profile will look like the following:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Profile&quot;, user_path(@user) %&gt;</span>
</span><span class='line'><span class="sx"># =</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/users/1&quot;</span><span class="o">&gt;</span><span class="no">Profile</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  There&#8217;s also a shorter version that will do the same thing. It&#8217;s got some magic to it (like most things in Rails) but it also looks prettier and there&#8217;s less to type (two stones with one bird).
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Profile&quot;, @user %&gt;</span>
</span><span class='line'><span class="sx"># =</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/users/1&quot;</span><span class="o">&gt;</span><span class="no">Profile</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Using link_to with a Block</strong><br/>
  This is somewhat of a lesser known/used option of <code>link_to</code> but it&#8217;s useful nonetheless and it also makes the code more readable. So in those cases where the link text is long and/or ugly, or it doesn&#8217;t really fit on a 80 chars line, you can pass the link text inside a block.
</p>




<p>
  To make the example more obvious, I&#8217;m gonna do a before and after kind of thing.
</p>




<p>
  Before:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;&lt;span class=</span><span class="s1">&#39;home-link&#39;</span><span class="o">&gt;</span><span class="no">Home</span><span class="o">&lt;</span><span class="sr">/span&gt;&quot;.html_safe, root_path %&gt;</span>
</span><span class='line'><span class="sr"># =&gt; &lt;a href=&quot;/</span><span class="s2">&quot;&gt;&lt;span class=&quot;</span><span class="n">home</span><span class="o">-</span><span class="n">link</span><span class="s2">&quot;&gt;Home&lt;/span&gt;&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  After:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to root_path do %&gt;</span>
</span><span class='line'><span class="sx">  &lt;%=</span> <span class="n">content_tag</span> <span class="ss">:span</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s2">&quot;home-link&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;% end %&gt;</span>
</span><span class='line'><span class="c1"># =&gt; &lt;a href=&quot;/&quot;&gt;&lt;span class=&quot;home-link&quot;&gt;Home&lt;/span&gt;&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  In this case I&#8217;ve purposely chosen a less uglier link text, but usually the link text will be something like an image tag or a span with an icon inside it (or any other ugly html code you can think of).
</p>




<p>
  <strong>Adding html classes and/or id to Your Link</strong><br/>
  Another very common task you&#8217;ll use is to add a html class or id to your links.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Section&quot;, root_path, :class =</span><span class="o">&gt;</span> <span class="s2">&quot;my-class&quot;</span><span class="p">,</span> <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="s2">&quot;my-id&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;my-class&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;my-id&quot;</span><span class="o">&gt;</span><span class="no">Section</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>How to Delete a Record with link_to</strong><br/>
  Calling the <code>destroy</code> action of a REST-ful controller requires a <code>DELETE</code> request and that can be easily achieved by passing the <code>:method => :delete</code> hash as an option to the <code>link_to</code> helper.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Remove&quot;, @user, :method =</span><span class="o">&gt;</span> <span class="ss">:delete</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;nofollow&quot;</span> <span class="n">data</span><span class="o">-</span><span class="nb">method</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/users/1&quot;</span><span class="o">&gt;</span><span class="no">Remove</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Note that the <code>rel="nofollow"</code> is auto-magically added by Rails as an SEO bonus.
</p>




<p>
  <strong>Require Confirmation for Deleting a Record</strong><br/>
  You will probably want some sort of confirmation when removing objects to prevent accidental deletes. The easiest way to add that is with a simple javascript alert box that will ask the user to confirm his delete request.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Remove&quot;, @user, :method =</span><span class="o">&gt;</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:confirm</span> <span class="o">=&gt;</span> <span class="s2">&quot;You Sure?&quot;</span><span class="p">}</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">data</span><span class="o">-</span><span class="n">confirm</span><span class="o">=</span><span class="s2">&quot;You Sure?&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;nofollow&quot;</span> <span class="n">data</span><span class="o">-</span><span class="nb">method</span><span class="o">=</span><span class="s2">&quot;delete&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/users/1&quot;</span><span class="o">&gt;</span><span class="no">Remove</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Link-ing to an Image with link_to</strong><br/>
  It might be that you want to make your links prettier or that you want to have some nice buttons, or even a logo click-able or whatever the reason for using click-able images is, you&#8217;ll want to add your image inside the link. Making an image link-able is pretty straight forward. Just add the <code>image_tag</code> where the link text would go and you&#8217;re done.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to image_tag(&#39;logo.png&#39;), root_path %&gt;</span>
</span><span class='line'><span class="sx"># =</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;/assets/logo-c88948e05e11587af2c23747862ca433.png&quot;</span> <span class="n">alt</span><span class="o">=</span><span class="s2">&quot;Logo&quot;</span><span class="o">&gt;&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  You can also pass the image in a block if you like that style better.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to root_path do %&gt;</span>
</span><span class='line'><span class="sx">  &lt;%=</span> <span class="n">image_tag</span><span class="p">(</span><span class="s1">&#39;logo.png&#39;</span><span class="p">)</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">&lt;% end %&gt;</span>
</span><span class='line'><span class="c1"># =&gt; &lt;a href=&quot;/&quot;&gt;&lt;img src=&quot;/assets/logo-c88948e05e11587af2c23747862ca433.png&quot; alt=&quot;Logo&quot;&gt;&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  A nice side-effect of using the <code>image_tag</code> helper is that it will add the asset digest to your image.
</p>




<p>
  <strong>Adding an alt Attribute to the Image</strong><br/>
  As you&#8217;ve seen in the previous example, I didn&#8217;t specify an alt attribute but the link_to helper generated one. The generated alt tag is just the name of the image file, capitalized. In case you want (and you should want) to override the alt attribute, it&#8217;s very easy to do; just add your own alt attribute like so:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to image_tag(&#39;logo.png&#39;), root_path, :alt =</span><span class="o">&gt;</span> <span class="s2">&quot;MyLogo&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;/assets/logo-c88948e05e11587af2c23747862ca433.png&quot;</span> <span class="n">alt</span><span class="o">=</span><span class="s2">&quot;MyLogo&quot;</span><span class="o">&gt;&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  Alt attributes are beneficial for SEO purposes and they also aid those visitors who use text readers or non graphical browsers.
</p>




<p>
  <strong>Link-ing to an Image</strong><br/>
  There are times when you might want to link to an image (not necessarily with an image). This can be confusing because you need your image to contain the image digest generated by the asset pipeline. There&#8217;s a helper that provides just that and it&#8217;s called <code>image_path</code>.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Logo&quot;, image_path(&#39;logo.png&#39;) %&gt;</span>
</span><span class='line'><span class="sx"># =</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/assets/logo-c88948e05e11587af2c23747862ca433.png&quot;</span><span class="o">&gt;</span><span class="no">Logo</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Anchors with link_to</strong><br/>
  You might need to point to a specific section (anchor) in the page which you can identify by it&#8217;s dom ID. So let&#8217;s say on the target page we have a section that has the <code>id="interesting-section"</code>. In order to point our link to that section, we&#8217;ll need to add the anchor to the generated link.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Section&quot;, root_path(:anchor =</span><span class="o">&gt;</span> <span class="s2">&quot;interesting-section&quot;</span><span class="p">)</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/#interesting-section&quot;</span><span class="o">&gt;</span><span class="no">Section</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Ajax Links with link_to Remote</strong><br/>
  You can add the <code>:remote => true</code> option to the link to tell Rails that you want to handle the link via javascript. This option will automatically send an ajax request (handled via the jQuery UJS adapter).
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Ajax&quot;, root_path, :remote =</span><span class="o">&gt;</span> <span class="kp">true</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">data</span><span class="o">-</span><span class="n">remote</span><span class="o">=</span><span class="s2">&quot;true&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="no">Ajax</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Opening the link in a new tab or window</strong><br/>
  For a good user experience and because you&#8217;ll want your user not to leave your website if possible, you should make all your external links open in a separate tab or window. You can achieve this by using the <code>target="_blank"</code> html attribute which in Rails speak will look like this:
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Google&quot;, &quot;http://google.com&quot;, :target =</span><span class="o">&gt;</span> <span class="s2">&quot;_blank&quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;_blank&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;http://google.com&quot;</span><span class="o">&gt;</span><span class="no">Google</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>POST-ing Using link_to</strong><br/>
  Sending a post request via a link is something that the html cannot do. You can only use it to make <code>GET</code> requests, not <code>POST</code>. That being said, Rails has some magic tricks for you.
</p>




<p>
  By providing the <code>:method => :post</code> option, Rails will create a form and submit it via javascript. Note that you need the <code>jquery-rails</code> gem for this to work, if you don&#8217;t have it, there won&#8217;t be any magic happening and your links will default to a GET request.
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Post&quot;, root_path, :method =</span><span class="o">&gt;</span> <span class="ss">:post</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;nofollow&quot;</span> <span class="n">data</span><span class="o">-</span><span class="nb">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="no">Post</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  <strong>Adding More Params to the POST Request</strong><br/>
</p>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= link_to &quot;Create User&quot;, users_path(:email =</span><span class="o">&gt;</span> <span class="s2">&quot;jdoe@email.com&quot;</span><span class="p">,</span> <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s2">&quot;secret&quot;</span><span class="p">),</span> <span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:post</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx"># =&gt;</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;nofollow&quot;</span> <span class="n">data</span><span class="o">-</span><span class="nb">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/users?email=jdoe%40email.com&amp;amp;password=secret&quot;</span><span class="o">&gt;</span><span class="no">Create</span> <span class="no">User</span><span class="o">&lt;</span><span class="sr">/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<p>
  These are some of the more common ways I&#8217;ve used link_to but I&#8217;m sure there are many others. So if you have any other examples I could add to the article.
</p>




<p>
  So far so good, That&#8217;s it!!! See ya!!! :)
</p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Like To News Article</h1>
  <ul>
    <li>
      <div class="fb-page" data-href="https://www.facebook.com/geekhmer" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true" data-show-posts="false"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/geekhmer"><a href="https://www.facebook.com/geekhmer">GeeKhmer</a></blockquote></div></div>
    </li>
  </ul>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/04/26/installation-and-configuration-nginx-as-reverse-proxy-for-apache-on-ubuntu-server/">Installation and Configuration Nginx as Reverse Proxy for Apache on Ubuntu Server</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/03/sell-me-this-pen/">Simple Sales Framework for &#8220;Sell Me This Pen&#8221;</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/27/why-is-website-maintenance-important/">Why Is Website Maintenance Important?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/24/online-payment-gateway-in-cambodia/">Online Payment Gateway in Cambodia</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/21/generating-income-on-the-internet-using-social-media/">Generating Income on the Internet Using Social Media</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/19/copy-to-clipboard-without-flash-with-clipboard-dot-js/">Copy to Clipboard Without Flash With Clipboard.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/16/http-status-code-and-symbols/">HTTP Status Code and Symbols</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Category</h1>
  <ul id="recent_posts">
    
      <li>
        <a href="/blog/categories/facebook/">Facebook [ 5 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby/">Ruby [ 109 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/heroku/">Heroku [ 2 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby-on-rails/">Ruby on rails [ 105 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/testing/">Testing [ 5 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/layout/">Layout [ 3 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/ruby-metaprogramming/">Ruby metaprogramming [ 4 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/websocket/">Websocket [ 2 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/front-end-mvc-framework/">Front-end mvc framework [ 1 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/javascript/">Javascript [ 26 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/erlang/">Erlang [ 20 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/design-pattern/">Design pattern [ 1 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/other/">Other [ 43 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/reactjs/">Reactjs [ 18 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/startup/">Startup [ 2 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/cambodia-hacker-place/">Cambodia hacker place [ 2 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/gulp/">Gulp [ 18 ]</a>
      </li>
    
      <li>
        <a href="/blog/categories/internet-marketing/">Internet marketing [ 2 ]</a>
      </li>
    
  </ul>
</section><section>
  <h1>Notes</h1>
  <ul id="recent_posts">
    <li>
      <a href="http://vimcommands.github.io/" target="_blank">Vim Commands</a>
    </li>
    <li>
      <a href="http://ruby-hacking-style-guide.github.io/" target="_blank">Ruby Hacking Style Guide</a>
    </li>
  </ul>
</section><section>
  <h1>References</h1>
  <ul id="recent_posts">
    <li>
      <a href="http://www.erlang.org/" target="_blank">
        <img src="/images/logo_erlang.png" />
      </a>
    </li>
    <li>
      <a href="http://www.chicagoboss.org/" target="_blank">
        <img src="/images/logo_chicagoboss.svg" />
      </a>
    </li>
    <li>
      <a href="https://www.ruby-lang.org/en/" target="_blank">
        <img src="/images/logo_ruby.png" />
      </a>
    </li>
    <li>
      <a href="http://guides.rubyonrails.org" target="_blank">
        <img src="/images/logo_rails_guides.png" />
      </a>
    </li>
    <li>
      <a href="http://railscasts.com" target="_blank">
        <img src="/images/logo_rails_casts.png" />
      </a>
    </li>
    <li>
      <a href="https://github.com" target="_blank">
        <img src="/images/logo_github.png" />
      </a>
    </li>
    <li>
      <a href="https://www.linode.com" target="_blank">
        <img src="/images/logo_linode.png" />
      </a>
    </li>
    <li>
      <a href="http://newrelic.com" target="_blank">
        <img src="/images/logo_newrelic.png" />
      </a>
    </li>
    <li>
      <a href="https://developers.facebook.com/" target="_blank">
        <img src="/images/logo_facebook.png" />
      </a>
    </li>
    <li>
      <a href="https://facebook.github.io/react/" target="_blank">
        <img src="/images/logo_react.png" />
      </a>
    </li>
  </ul>
</section>




  
</aside>
    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 GeeKhmer in Phnom Penh, Cambodia.
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=1451301955117043&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
